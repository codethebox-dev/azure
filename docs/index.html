<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>codethebox.dev — Cloud & Tech Learning Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
<style>
/* ══════════════════════════════════════
   DESIGN TOKENS — Dark Terminal Aesthetic
══════════════════════════════════════ */
:root {
  --bg0:      #070B14;
  --bg1:      #0C1220;
  --bg2:      #111827;
  --bg3:      #1A2235;
  --bg4:      #1E2A3E;
  --border:   rgba(255,255,255,0.08);
  --border2:  rgba(255,255,255,0.14);
  --text:     #E8EDF5;
  --text2:    #94A3B8;
  --text3:    #64748B;

  --accent:   #00D4FF;
  --accent2:  #0099CC;
  --green:    #10B981;
  --amber:    #F59E0B;
  --rose:     #F43F5E;
  --violet:   #8B5CF6;

  /* Provider colors */
  --aws:      #FF9900;
  --gcp:      #4285F4;
  --azure:    #0078D4;
  --m365:     #D83B01;
  --comptia:  #C8202A;
  --linux:    #FCC624;
  --k8s:      #326CE5;

  /* Levels */
  --fund:     #3B82F6;
  --assoc:    #10B981;
  --pro:      #8B5CF6;
  --expert:   #F43F5E;
  --specialty:#F59E0B;

  --sidebar-w: 280px;
  --hdr-h:     60px;
  --radius:    8px;
  --radius-lg: 14px;
  --glow:      0 0 20px rgba(0,212,255,0.15);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }

body {
  font-family: 'Space Grotesk', sans-serif;
  background: var(--bg0);
  color: var(--text);
  font-size: 14px;
  line-height: 1.7;
  overflow-x: hidden;
  min-height: 100vh;
}

/* Scanline overlay */
body::before {
  content: '';
  position: fixed; inset: 0;
  background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.015) 2px, rgba(0,0,0,0.015) 4px);
  pointer-events: none; z-index: 9999;
}

::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: var(--bg1); }
::-webkit-scrollbar-thumb { background: var(--bg4); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--accent2); }

/* ══════ HEADER ══════ */
header {
  position: fixed; top: 0; left: 0; right: 0;
  height: var(--hdr-h);
  background: rgba(7,11,20,0.92);
  backdrop-filter: blur(16px);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center;
  padding: 0 20px; gap: 14px;
  z-index: 500;
}

.logo-wrap {
  display: flex; align-items: center; gap: 10px;
  text-decoration: none; flex-shrink: 0; cursor: pointer;
}
.logo-mark {
  width: 36px; height: 36px;
  background: linear-gradient(135deg, var(--accent), #0055CC);
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  position: relative; overflow: hidden;
  box-shadow: 0 0 16px rgba(0,212,255,0.35);
}
.logo-mark::after {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.15), transparent);
}
.logo-mark svg { width: 20px; height: 20px; z-index: 1; }
.logo-text {
  font-family: 'JetBrains Mono', monospace;
  font-size: 15px; font-weight: 600; color: var(--text);
  letter-spacing: -0.02em;
}
.logo-text span { color: var(--accent); }
.logo-tld { color: var(--text3); font-size: 13px; }

.hdr-divider { width: 1px; height: 22px; background: var(--border); flex-shrink: 0; }

.hdr-nav {
  display: flex; align-items: center; gap: 4px;
}
.hdr-nav-btn {
  padding: 5px 12px; border-radius: 6px;
  background: none; border: none;
  font-family: 'Space Grotesk', sans-serif;
  font-size: 13px; font-weight: 500; color: var(--text2);
  cursor: pointer; transition: all 0.15s;
}
.hdr-nav-btn:hover { color: var(--text); background: var(--bg3); }
.hdr-nav-btn.active { color: var(--accent); background: rgba(0,212,255,0.08); }

.hdr-right { display: flex; align-items: center; gap: 10px; margin-left: auto; }

/* Search */
.hdr-search {
  display: flex; align-items: center; gap: 7px;
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: 8px; padding: 0 12px;
  transition: border-color 0.2s;
}
.hdr-search:focus-within { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0,212,255,0.1); }
.hdr-search input {
  background: none; border: none; outline: none;
  color: var(--text); font-family: 'Space Grotesk', sans-serif;
  font-size: 13px; width: 180px; padding: 6px 0;
}
.hdr-search input::placeholder { color: var(--text3); }
.hdr-search svg { width: 14px; height: 14px; color: var(--text3); flex-shrink: 0; }

/* User area */
.user-chip {
  display: flex; align-items: center; gap: 8px;
  padding: 5px 12px 5px 6px;
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: 30px; cursor: pointer;
  transition: all 0.2s;
}
.user-chip:hover { border-color: var(--border2); background: var(--bg3); }
.user-avatar {
  width: 28px; height: 28px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 11px; font-weight: 800; flex-shrink: 0;
}
.ua-guest    { background: var(--bg4); color: var(--text3); border: 1px solid var(--border); }
.ua-student  { background: linear-gradient(135deg,#10B981,#059669); color: #fff; }
.ua-instructor { background: linear-gradient(135deg,#F59E0B,#D97706); color: #fff; }
.ua-admin    { background: linear-gradient(135deg,#F43F5E,#be123c); color: #fff; }

.user-chip .uc-info { display: flex; flex-direction: column; }
.uc-name { font-size: 12.5px; font-weight: 600; line-height: 1.2; }
.uc-role { font-size: 10.5px; color: var(--text3); }

.role-dot {
  width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0;
}
.dot-guest    { background: var(--text3); }
.dot-student  { background: var(--green); box-shadow: 0 0 6px var(--green); }
.dot-instructor { background: var(--amber); box-shadow: 0 0 6px var(--amber); }
.dot-admin    { background: var(--rose); box-shadow: 0 0 6px var(--rose); }

.login-btn {
  padding: 7px 16px; border-radius: 8px;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  border: none; color: #000; font-weight: 700;
  font-family: 'Space Grotesk', sans-serif; font-size: 13px;
  cursor: pointer; transition: all 0.2s;
  box-shadow: 0 0 14px rgba(0,212,255,0.3);
}
.login-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 20px rgba(0,212,255,0.4); }

/* ══════ VIEWS ══════ */
.view { display: none; }
.view.active { display: block; }

/* ══════════════════════════════════════
   LANDING / HOME
══════════════════════════════════════ */
#homeView {
  padding-top: var(--hdr-h);
}

.hero {
  min-height: calc(100vh - var(--hdr-h));
  display: flex; align-items: center;
  padding: 60px 60px 80px;
  position: relative; overflow: hidden;
}

.hero-bg {
  position: absolute; inset: 0; z-index: 0;
  background:
    radial-gradient(ellipse 60% 50% at 70% 50%, rgba(0,120,212,0.12) 0%, transparent 70%),
    radial-gradient(ellipse 40% 40% at 20% 80%, rgba(0,212,255,0.07) 0%, transparent 60%),
    radial-gradient(ellipse 50% 60% at 80% 10%, rgba(139,92,246,0.08) 0%, transparent 60%);
}
.hero-grid {
  position: absolute; inset: 0;
  background-image: linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
  background-size: 48px 48px;
}
.hero-glow {
  position: absolute; top: -20%; right: -10%;
  width: 600px; height: 600px; border-radius: 50%;
  background: radial-gradient(circle, rgba(0,212,255,0.08) 0%, transparent 70%);
  pointer-events: none;
}

.hero-content { position: relative; z-index: 1; max-width: 680px; }

.hero-badge {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 5px 14px; border-radius: 20px;
  border: 1px solid rgba(0,212,255,0.3);
  background: rgba(0,212,255,0.06);
  font-size: 12px; font-weight: 600; color: var(--accent);
  margin-bottom: 28px;
  font-family: 'JetBrains Mono', monospace;
}
.hero-badge::before { content:''; width:7px; height:7px; border-radius:50%; background:var(--accent); animation: pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.5;transform:scale(0.8)} }

.hero h1 {
  font-family: 'Outfit', sans-serif;
  font-size: clamp(42px, 5vw, 64px);
  font-weight: 900; line-height: 1.05;
  letter-spacing: -0.03em; margin-bottom: 20px;
}
.hero h1 em {
  font-style: normal;
  background: linear-gradient(135deg, var(--accent) 0%, #6EE7FF 50%, var(--violet) 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}

.hero p {
  font-size: 17px; color: var(--text2); max-width: 540px;
  line-height: 1.65; margin-bottom: 36px;
}

.hero-actions { display: flex; gap: 12px; flex-wrap: wrap; }

.btn-primary {
  padding: 12px 28px; border-radius: 10px;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  border: none; color: #000; font-weight: 700;
  font-family: 'Outfit', sans-serif; font-size: 15px;
  cursor: pointer; transition: all 0.25s;
  box-shadow: 0 0 20px rgba(0,212,255,0.3);
  display: flex; align-items: center; gap: 8px;
}
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 28px rgba(0,212,255,0.45); }
.btn-outline {
  padding: 12px 28px; border-radius: 10px;
  background: transparent; border: 1px solid var(--border2);
  color: var(--text); font-weight: 600;
  font-family: 'Outfit', sans-serif; font-size: 15px;
  cursor: pointer; transition: all 0.25s;
}
.btn-outline:hover { background: var(--bg3); border-color: var(--accent); color: var(--accent); }

.hero-providers {
  margin-top: 60px;
  display: flex; align-items: center; gap: 20px; flex-wrap: wrap;
}
.hero-providers span { font-size: 12px; color: var(--text3); font-weight: 500; }
.provider-logos { display: flex; gap: 10px; flex-wrap: wrap; }
.plogo {
  padding: 6px 14px; border-radius: 6px;
  border: 1px solid var(--border);
  font-size: 12px; font-weight: 700;
  font-family: 'JetBrains Mono', monospace;
  background: var(--bg2);
  transition: all 0.2s;
}
.plogo:hover { border-color: var(--border2); transform: translateY(-1px); }
.plogo.aws { color: var(--aws); }
.plogo.gcp { color: var(--gcp); }
.plogo.azure { color: var(--azure); }
.plogo.m365 { color: var(--m365); }
.plogo.comptia { color: var(--comptia); }

/* Stats strip */
.stats-strip {
  display: grid; grid-template-columns: repeat(4,1fr);
  border-top: 1px solid var(--border);
  border-bottom: 1px solid var(--border);
}
.stat-cell {
  padding: 28px 32px;
  border-right: 1px solid var(--border);
  text-align: center;
}
.stat-cell:last-child { border-right: none; }
.stat-num {
  font-family: 'Outfit', sans-serif;
  font-size: 36px; font-weight: 900;
  background: linear-gradient(135deg, var(--accent), var(--violet));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.stat-label { font-size: 12.5px; color: var(--text3); margin-top: 2px; font-weight: 500; }

/* ══════════════════════════════════════
   CATALOG
══════════════════════════════════════ */
#catalogView { padding-top: var(--hdr-h); min-height: 100vh; }

.catalog-header {
  padding: 40px 48px 28px;
  background: linear-gradient(180deg, var(--bg1) 0%, transparent 100%);
  border-bottom: 1px solid var(--border);
}
.catalog-header h1 {
  font-family: 'Outfit', sans-serif;
  font-size: 28px; font-weight: 800; letter-spacing: -0.02em;
  margin-bottom: 6px;
}
.catalog-header p { color: var(--text2); font-size: 14px; }

/* Provider tabs */
.provider-tabs {
  display: flex; gap: 6px; flex-wrap: wrap;
  padding: 16px 48px; border-bottom: 1px solid var(--border);
  position: sticky; top: var(--hdr-h); background: rgba(7,11,20,0.95);
  backdrop-filter: blur(12px); z-index: 50;
}
.ptab {
  display: flex; align-items: center; gap: 7px;
  padding: 7px 14px; border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--bg2); cursor: pointer;
  font-family: 'Space Grotesk', sans-serif;
  font-size: 12.5px; font-weight: 600; color: var(--text2);
  transition: all 0.2s;
}
.ptab:hover { border-color: var(--border2); color: var(--text); }
.ptab.active { color: #000 !important; border-color: transparent !important; }
.ptab.all.active { background: var(--accent); color: #000; }
.ptab.aws.active  { background: var(--aws); }
.ptab.gcp.active  { background: var(--gcp); }
.ptab.azure.active { background: var(--azure); }
.ptab.m365.active  { background: var(--m365); }
.ptab.comptia.active { background: var(--comptia); }
.ptab.more.active  { background: var(--violet); }

.ptab-dot { width: 8px; height: 8px; border-radius: 50%; }

/* Level filter row */
.level-row {
  padding: 12px 48px; border-bottom: 1px solid var(--border);
  display: flex; gap: 8px; align-items: center;
}
.level-row span { font-size: 11.5px; font-weight: 700; color: var(--text3); text-transform: uppercase; letter-spacing: 0.1em; margin-right: 4px; }
.lvl-btn {
  padding: 4px 12px; border-radius: 20px;
  font-size: 12px; font-weight: 600;
  border: 1px solid var(--border); background: transparent;
  color: var(--text2); cursor: pointer;
  font-family: 'Space Grotesk', sans-serif;
  transition: all 0.15s;
}
.lvl-btn:hover { border-color: var(--border2); color: var(--text); }
.lvl-btn.active { color: #000; border-color: transparent; }
.lvl-btn.all.active { background: var(--accent); }
.lvl-btn.Fundamentals.active { background: var(--fund); }
.lvl-btn.Associate.active    { background: var(--assoc); }
.lvl-btn.Professional.active { background: var(--pro); }
.lvl-btn.Expert.active       { background: var(--expert); }
.lvl-btn.Specialty.active    { background: var(--specialty); }

/* Cards grid */
.courses-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(310px, 1fr));
  gap: 18px;
  padding: 28px 48px 60px;
}

.course-card {
  background: var(--bg1);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  overflow: hidden; cursor: pointer;
  transition: all 0.25s; position: relative;
}
.course-card::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 3px;
  transition: opacity 0.2s;
}
.course-card:hover { transform: translateY(-3px); border-color: var(--border2); box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
.course-card:hover::before { opacity: 1; }

.card-top { padding: 22px 22px 16px; }
.card-provider-row { display: flex; align-items: center; gap: 10px; margin-bottom: 14px; }
.provider-badge {
  display: flex; align-items: center; gap: 6px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px; font-weight: 600;
  padding: 4px 10px; border-radius: 5px;
  border: 1px solid currentColor; opacity: 0.85;
}
.level-badge {
  font-size: 10.5px; font-weight: 700; padding: 3px 9px;
  border-radius: 4px; text-transform: uppercase; letter-spacing: 0.06em;
  margin-left: auto;
}
.lbg-Fundamentals { background: rgba(59,130,246,0.15); color: var(--fund); }
.lbg-Associate    { background: rgba(16,185,129,0.15); color: var(--assoc); }
.lbg-Professional { background: rgba(139,92,246,0.15); color: var(--pro); }
.lbg-Expert       { background: rgba(244,63,94,0.15); color: var(--expert); }
.lbg-Specialty    { background: rgba(245,158,11,0.15); color: var(--specialty); }

.course-card h3 { font-family:'Outfit',sans-serif; font-size:16px; font-weight:700; margin-bottom:6px; line-height:1.3; }
.course-card p  { font-size:13px; color:var(--text2); line-height:1.6; }

.card-meta {
  padding: 12px 22px; border-top: 1px solid var(--border);
  display: flex; align-items: center; gap: 14px;
}
.cm { display:flex; align-items:center; gap:5px; font-size:12px; color:var(--text3); font-weight:500; }
.cm svg { width:12px; height:12px; }

.card-progress { margin-left:auto; text-align:right; }
.prog-bar { width:70px; height:4px; background:var(--bg4); border-radius:2px; overflow:hidden; }
.prog-fill { height:100%; border-radius:2px; transition:width 0.6s; }

.card-footer {
  padding: 12px 22px; background: var(--bg2);
  border-top: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
}
.open-btn {
  display:flex; align-items:center; gap:6px;
  color: var(--accent); font-weight:700; font-size:13px;
  background:none; border:none; cursor:pointer;
  font-family:'Space Grotesk',sans-serif;
  transition: gap 0.2s;
}
.open-btn:hover { gap:9px; }
.open-btn svg { width:14px; height:14px; }

.cert-id {
  font-family:'JetBrains Mono',monospace;
  font-size:11px; color:var(--text3); font-weight:500;
}

/* ══════════════════════════════════════
   COURSE VIEW
══════════════════════════════════════ */
#courseView {
  display: none;
  padding-top: var(--hdr-h);
}
#courseView.active { display: flex; }

/* Left sidebar */
.c-sidebar {
  width: var(--sidebar-w); flex-shrink: 0;
  background: var(--bg1); border-right: 1px solid var(--border);
  position: fixed; top: var(--hdr-h); left: 0; bottom: 0;
  overflow-y: auto; z-index: 100;
}

.c-sidebar-hdr {
  padding: 18px 16px 14px;
  border-bottom: 1px solid var(--border);
  position: sticky; top: 0; background: var(--bg1); z-index: 5;
}
.csb-id {
  font-family:'JetBrains Mono',monospace; font-size:12px; font-weight:600;
  padding: 4px 10px; border-radius: 5px;
  display: inline-block; margin-bottom: 8px;
  border: 1px solid currentColor; opacity: 0.8;
}
.csb-title { font-size:14px; font-weight:700; line-height:1.35; }
.csb-prog { display:flex; align-items:center; gap:8px; margin-top:10px; }
.csb-prog .prog-bar { flex:1; height:5px; }
.csb-prog span { font-size:11px; font-weight:700; color:var(--accent); font-family:'JetBrains Mono',monospace; }

/* Module list */
.module-list { padding: 8px 0 20px; }

.mod-item { border-bottom: 1px solid var(--border); }
.mod-hdr {
  display:flex; align-items:center; gap:8px;
  padding: 10px 14px;
  cursor: pointer; user-select:none; transition:background 0.15s;
}
.mod-hdr:hover { background: var(--bg2); }
.mod-hdr.exp { background: var(--bg2); }
.mod-num {
  width:22px; height:22px; border-radius:5px;
  font-size:10.5px; font-weight:800;
  display:flex; align-items:center; justify-content:center;
  color:#fff; flex-shrink:0; font-family:'JetBrains Mono',monospace;
}
.mod-title { font-size:12.5px; font-weight:600; flex:1; color:var(--text2); line-height:1.3; }
.mod-hdr.exp .mod-title { color: var(--text); }
.mod-chev { width:14px; height:14px; color:var(--text3); transition:transform 0.25s; flex-shrink:0; }
.mod-hdr.exp .mod-chev { transform:rotate(90deg); }
.mod-cnt { font-size:10px; font-weight:700; color:var(--text3); background:var(--bg3); padding:2px 6px; border-radius:8px; flex-shrink:0; }

.mod-subitems { display:none; }
.mod-subitems.open { display:block; }

.sub-item {
  display:flex; align-items:center; gap:7px;
  padding: 7px 14px 7px 42px;
  cursor:pointer; border-left:2px solid transparent;
  transition:all 0.15s; font-size:12.5px; color:var(--text3);
}
.sub-item:hover { background:rgba(255,255,255,0.03); color:var(--text2); }
.sub-item.active { background:rgba(0,212,255,0.07); color:var(--accent); border-left-color:var(--accent); font-weight:600; }

.sub-item .si-ico { width:12px; height:12px; flex-shrink:0; }
.si-type {
  font-size:9px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em;
  padding:1px 5px; border-radius:3px; margin-left:auto; flex-shrink:0;
  font-family:'JetBrains Mono',monospace;
}
.si-doc   { background:rgba(0,212,255,0.12); color:var(--accent); }
.si-lab   { background:rgba(16,185,129,0.12); color:var(--green); }
.si-video { background:rgba(244,63,94,0.12); color:var(--rose); }

.sub-done { color: var(--green); }
.sub-todo { color: var(--bg4); }

.add-page-in-module {
  display:none; padding: 6px 14px 10px 42px;
}
body.edit-mode .add-page-in-module { display:block; }
.add-pg-btn {
  width:100%; padding:6px; border:1px dashed var(--border2);
  border-radius:5px; background:transparent; color:var(--text3);
  font-size:11.5px; cursor:pointer; font-family:'Space Grotesk',sans-serif;
  transition:all 0.15s; font-weight:600;
}
.add-pg-btn:hover { border-color:var(--accent); color:var(--accent); }

/* Content area */
.c-main { margin-left:var(--sidebar-w); flex:1; display:flex; }

.content-area {
  flex:1; padding:40px 52px;
  background:var(--bg0); min-height:calc(100vh - var(--hdr-h));
  margin-right:210px;
}

.c-toc {
  width:210px; flex-shrink:0;
  position:fixed; top:var(--hdr-h); right:0; bottom:0;
  overflow-y:auto; padding:20px 14px;
  border-left:1px solid var(--border);
  background: var(--bg1);
}
.toc-lbl { font-size:10px; font-weight:700; letter-spacing:0.14em; text-transform:uppercase; color:var(--text3); margin-bottom:10px; padding-left:8px; }
.toc-a { display:block; padding:4px 8px; font-size:12px; color:var(--text3); text-decoration:none; border-left:2px solid transparent; transition:all 0.15s; line-height:1.5; }
.toc-a:hover { color:var(--text2); }
.toc-a.active { color:var(--accent); border-left-color:var(--accent); font-weight:600; }

/* breadcrumb */
.bcrumb { display:flex; align-items:center; gap:6px; font-size:12px; color:var(--text3); margin-bottom:22px; }
.bcrumb a { color:var(--accent); text-decoration:none; cursor:pointer; }
.bcrumb a:hover { text-decoration:underline; }

.content-type-chip {
  display:inline-flex; align-items:center; gap:6px;
  padding:4px 12px; border-radius:20px; font-size:11.5px; font-weight:700; text-transform:uppercase; letter-spacing:0.06em; margin-bottom:12px;
}
.ctc-doc   { background:rgba(0,212,255,0.1); color:var(--accent); border:1px solid rgba(0,212,255,0.2); }
.ctc-lab   { background:rgba(16,185,129,0.1); color:var(--green); border:1px solid rgba(16,185,129,0.2); }
.ctc-video { background:rgba(244,63,94,0.1); color:var(--rose); border:1px solid rgba(244,63,94,0.2); }
.ctc-doc svg,.ctc-lab svg,.ctc-video svg { width:12px; height:12px; }

.page-title-h {
  font-family:'Outfit',sans-serif; font-size:28px; font-weight:800;
  letter-spacing:-0.02em; line-height:1.2; margin-bottom:24px;
  outline:none; color:var(--text);
}
.page-title-h[contenteditable="true"] { border-bottom:2px dashed var(--accent); }

/* Blocks */
.blocks-container { max-width:720px; }

.block { position:relative; margin-bottom:6px; border-radius:6px; transition:outline 0.15s; }
body.edit-mode .block:hover { outline:1px dashed rgba(0,212,255,0.4); }
body.edit-mode .block:hover .btb-wrap { opacity:1; pointer-events:all; }

.btb-wrap { position:absolute; top:-12px; right:0; display:flex; gap:3px; opacity:0; pointer-events:none; transition:opacity 0.15s; z-index:10; }
.btb {
  width:22px; height:22px; border-radius:4px;
  border:1px solid var(--border2); background:var(--bg2);
  cursor:pointer; font-size:10.5px;
  display:flex; align-items:center; justify-content:center;
  box-shadow:var(--shadow-sm); color:var(--text3); transition:all 0.15s;
}
.btb.del:hover { background:#3B0A12; color:var(--rose); border-color:var(--rose); }
.btb.mov:hover { background:rgba(0,212,255,0.1); color:var(--accent); border-color:var(--accent); }

/* Text block */
.b-text p { margin-bottom:14px; color:var(--text2); font-size:14.5px; line-height:1.75; }
.b-text p[contenteditable="true"] { outline:none; border-bottom:1px dashed var(--accent); min-height:24px; background:rgba(0,212,255,0.03); padding:4px; border-radius:4px 4px 0 0; }

h2.b-h { font-family:'Outfit',sans-serif; font-size:20px; font-weight:700; color:var(--text); margin-top:8px; margin-bottom:14px; padding-bottom:8px; border-bottom:1px solid var(--border); }
h2.b-h[contenteditable="true"] { outline:none; border-bottom:2px dashed var(--accent); }

.callout { padding:14px 18px; border-radius:8px; margin:4px 0; display:flex; gap:12px; font-size:13.5px; }
.callout.note    { background:rgba(0,212,255,0.06); border-left:3px solid var(--accent); }
.callout.tip     { background:rgba(16,185,129,0.06); border-left:3px solid var(--green); }
.callout.warning { background:rgba(245,158,11,0.06); border-left:3px solid var(--amber); }
.callout.danger  { background:rgba(244,63,94,0.06); border-left:3px solid var(--rose); }
.c-ico { font-size:17px; flex-shrink:0; margin-top:1px; }
.c-body { flex:1; color:var(--text2); }
.c-body[contenteditable="true"] { outline:none; }

pre.b-code {
  background:var(--bg2); border:1px solid var(--border); border-radius:8px;
  padding:18px 20px; overflow-x:auto; margin:4px 0;
  border-left:3px solid var(--accent);
  font-family:'JetBrains Mono',monospace; font-size:13px; color:#94D4FF; line-height:1.6;
}
pre.b-code[contenteditable="true"] { outline:1px dashed rgba(0,212,255,0.3); }

.b-video { margin:4px 0; border-radius:10px; overflow:hidden; border:1px solid var(--border); background:var(--bg2); }
.video-wrapper { position:relative; width:100%; padding-bottom:56.25%; background:var(--bg2); }
.video-wrapper iframe { position:absolute; inset:0; width:100%; height:100%; border:none; }
.video-ph { position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:12px; color:var(--text3); }
.video-ph svg { width:48px; height:48px; }
.v-cap { padding:10px 16px; font-size:12.5px; color:var(--text3); background:var(--bg2); border-top:1px solid var(--border); }
.v-cap[contenteditable="true"] { outline:none; }

.b-image { margin:4px 0; border-radius:10px; overflow:hidden; border:1px solid var(--border); }
.img-ph { background:var(--bg2); height:180px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px; color:var(--text3); cursor:pointer; transition:background 0.15s; }
.img-ph:hover { background:var(--bg3); }
.img-ph svg { width:32px; height:32px; }
.img-actual { width:100%; display:block; }
.i-cap { padding:10px 16px; font-size:12.5px; color:var(--text3); background:var(--bg2); border-top:1px solid var(--border); }

.b-link-card {
  display:flex; align-items:center; gap:14px;
  padding:14px 18px; border:1px solid var(--border); border-radius:8px;
  text-decoration:none; background:var(--bg1); margin:4px 0;
  transition:all 0.2s; cursor:pointer;
}
.b-link-card:hover { border-color:var(--accent); background:rgba(0,212,255,0.04); }
.b-link-icon { width:36px; height:36px; border-radius:8px; background:rgba(0,212,255,0.1); display:flex; align-items:center; justify-content:center; flex-shrink:0; }
.b-link-icon svg { width:18px; height:18px; color:var(--accent); }
.blk-lt { font-size:14px; font-weight:700; color:var(--text); }
.blk-ld { font-size:12px; color:var(--text3); }
.blk-arr { margin-left:auto; color:var(--text3); }
.blk-arr svg { width:16px; height:16px; }

.b-card { border:1px solid var(--border); border-radius:10px; padding:18px 20px; background:var(--bg2); margin:4px 0; }
.b-card h4 { font-size:14.5px; font-weight:700; margin-bottom:6px; color:var(--text); }
.b-card h4[contenteditable="true"] { outline:none; border-bottom:1px dashed var(--accent); }
.b-card p  { font-size:13.5px; color:var(--text2); }
.b-card p[contenteditable="true"] { outline:none; }

/* Lab UI */
.lab-header-bar {
  background:linear-gradient(135deg,rgba(16,185,129,0.15),rgba(16,185,129,0.05));
  border:1px solid rgba(16,185,129,0.25); border-radius:12px;
  padding:20px 24px; margin-bottom:24px;
  display:flex; align-items:center; gap:16px;
}
.lab-ico-wrap { width:48px; height:48px; border-radius:12px; background:rgba(16,185,129,0.2); display:flex; align-items:center; justify-content:center; flex-shrink:0; }
.lab-ico-wrap svg { width:26px; height:26px; color:var(--green); }
.lab-hdr-text h3 { font-family:'Outfit',sans-serif; font-size:17px; font-weight:800; color:var(--green); }
.lab-hdr-text p { font-size:13px; color:var(--text3); }

.lab-meta-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:24px; }
.lab-mc { background:var(--bg2); border:1px solid var(--border); border-radius:8px; padding:14px; text-align:center; }
.lab-mc .lmv { font-family:'JetBrains Mono',monospace; font-size:20px; font-weight:700; color:var(--green); }
.lab-mc .lmk { font-size:11px; color:var(--text3); margin-top:2px; font-weight:600; }

.step-block { border:1px solid var(--border); border-radius:10px; margin:8px 0; overflow:hidden; background:var(--bg1); }
.step-hdr { display:flex; align-items:center; gap:10px; padding:13px 18px; background:var(--bg2); border-bottom:1px solid var(--border); cursor:pointer; }
.step-num-b { width:26px; height:26px; border-radius:50%; background:var(--green); color:#fff; font-size:12px; font-weight:800; display:flex; align-items:center; justify-content:center; flex-shrink:0; font-family:'JetBrains Mono',monospace; }
.step-hdr h4 { font-size:14px; font-weight:700; flex:1; }
.step-done-btn { padding:4px 12px; border-radius:20px; font-size:11.5px; font-weight:700; border:none; cursor:pointer; font-family:'Space Grotesk',sans-serif; transition:all 0.2s; }
.s-done   { background:rgba(16,185,129,0.15); color:var(--green); border:1px solid rgba(16,185,129,0.3); }
.s-undone { background:var(--bg3); color:var(--text3); border:1px solid var(--border); }
.step-body { padding:18px 20px; font-size:13.5px; color:var(--text2); line-height:1.7; }

/* Add block bar */
.add-block-bar { display:none; flex-wrap:wrap; gap:6px; margin:18px 0; align-items:center; }
body.edit-mode .add-block-bar { display:flex; }
.add-block-bar .abl { font-size:11px; font-weight:700; color:var(--text3); text-transform:uppercase; letter-spacing:0.08em; width:100%; margin-bottom:2px; }
.abb {
  display:flex; align-items:center; gap:5px; padding:5px 10px;
  border-radius:6px; border:1px dashed var(--border2); background:transparent;
  font-family:'Space Grotesk',sans-serif; font-size:12px; color:var(--text3);
  cursor:pointer; transition:all 0.15s;
}
.abb:hover { border-color:var(--accent); color:var(--accent); background:rgba(0,212,255,0.05); }

/* Prev/next */
.page-nav { display:flex; justify-content:space-between; margin-top:48px; padding-top:24px; border-top:1px solid var(--border); gap:14px; }
.pn-btn { display:flex; flex-direction:column; text-decoration:none; color:var(--text); padding:14px 18px; border:1px solid var(--border); border-radius:8px; flex:1; max-width:46%; transition:all 0.2s; background:var(--bg1); cursor:pointer; font-family:'Space Grotesk',sans-serif; text-align:left; }
.pn-btn:hover { border-color:var(--accent); background:rgba(0,212,255,0.04); }
.pn-dir { font-size:10.5px; font-weight:700; text-transform:uppercase; letter-spacing:0.1em; color:var(--text3); margin-bottom:3px; }
.pn-title { font-size:14px; font-weight:700; color:var(--accent); }
.pn-btn.right { text-align:right; margin-left:auto; }

/* ══════════════════════════════════════
   MANAGER VIEW
══════════════════════════════════════ */
#managerView { padding-top:var(--hdr-h); min-height:100vh; }
.mgr-hdr {
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  padding:32px 48px;
  border-bottom:1px solid var(--border);
}
.mgr-hdr h1 { font-family:'Outfit',sans-serif; font-size:24px; font-weight:800; letter-spacing:-0.01em; }
.mgr-hdr p { color:var(--text2); font-size:13.5px; margin-top:4px; }
.mgr-tabs { display:flex; gap:0; margin-top:20px; border-bottom:1px solid var(--border); }
.m-tab { padding:8px 20px; font-size:13px; font-weight:600; cursor:pointer; border:none; background:transparent; font-family:'Space Grotesk',sans-serif; transition:all 0.15s; color:var(--text3); border-bottom:2px solid transparent; margin-bottom:-1px; }
.m-tab:hover { color:var(--text2); }
.m-tab.active { color:var(--accent); border-bottom-color:var(--accent); }
.mgr-body { padding:32px 48px; }

.perm-table { width:100%; border-collapse:collapse; }
.perm-table th { background:var(--bg2); color:var(--text3); padding:10px 16px; font-size:11px; font-weight:700; text-align:left; text-transform:uppercase; letter-spacing:0.08em; border-bottom:1px solid var(--border); }
.perm-table td { padding:12px 16px; border-bottom:1px solid var(--border); font-size:13.5px; vertical-align:middle; }
.perm-table tr:hover td { background:var(--bg2); }

.u-av { width:32px; height:32px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; font-size:11px; font-weight:800; color:#fff; flex-shrink:0; }
.av-a { background:linear-gradient(135deg,var(--rose),#be123c); }
.av-i { background:linear-gradient(135deg,var(--amber),#d97706); }
.av-s { background:linear-gradient(135deg,var(--green),#059669); }

.perm-sel { padding:5px 10px; border:1px solid var(--border); border-radius:6px; font-family:'Space Grotesk',sans-serif; font-size:13px; background:var(--bg2); cursor:pointer; outline:none; color:var(--text); }

.mgr-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:14px; }
.mgr-card { background:var(--bg1); border:1px solid var(--border); border-radius:var(--radius-lg); padding:18px; transition:all 0.2s; }
.mgr-card:hover { border-color:var(--border2); }
.mgr-card h4 { font-size:14.5px; font-weight:700; margin-bottom:3px; }
.mgr-card p { font-size:12px; color:var(--text3); }
.mgr-actions { display:flex; gap:8px; margin-top:14px; }
.mc-btn { flex:1; padding:7px; border-radius:6px; font-size:12px; font-weight:600; font-family:'Space Grotesk',sans-serif; cursor:pointer; transition:all 0.15s; border:1px solid var(--border); background:var(--bg2); color:var(--text2); }
.mc-btn:hover { border-color:var(--border2); color:var(--text); }
.mc-btn.primary { background:var(--accent); color:#000; border-color:var(--accent); }
.mc-btn.primary:hover { background:#00c4ee; }
.mc-btn.danger { background:rgba(244,63,94,0.1); color:var(--rose); border-color:rgba(244,63,94,0.3); }

/* Instructor requests table */
.req-badge { display:inline-flex; align-items:center; gap:5px; font-size:11px; font-weight:700; padding:3px 9px; border-radius:20px; }
.req-pending  { background:rgba(245,158,11,0.12); color:var(--amber); }
.req-approved { background:rgba(16,185,129,0.12); color:var(--green); }
.req-rejected { background:rgba(244,63,94,0.12); color:var(--rose); }

/* ══════════════════════════════════════
   MODALS
══════════════════════════════════════ */
.modal-overlay {
  display:none; position:fixed; inset:0;
  background:rgba(0,0,0,0.7); backdrop-filter:blur(8px);
  z-index:800; align-items:center; justify-content:center;
}
.modal-overlay.open { display:flex; }
.modal {
  background:var(--bg1); border:1px solid var(--border2);
  border-radius:var(--radius-lg); padding:28px 32px;
  min-width:400px; max-width:520px; width:90%;
  box-shadow:0 24px 80px rgba(0,0,0,0.5);
  animation:mIn 0.22s cubic-bezier(.34,1.3,.64,1);
}
@keyframes mIn { from{opacity:0;transform:scale(0.93) translateY(-14px)} to{opacity:1;transform:none} }
.modal h3 { font-family:'Outfit',sans-serif; font-size:20px; font-weight:800; margin-bottom:20px; color:var(--text); }
.modal label { font-size:11px; font-weight:700; color:var(--text3); display:block; margin-bottom:5px; margin-top:14px; text-transform:uppercase; letter-spacing:0.08em; }
.modal input, .modal select, .modal textarea {
  width:100%; padding:9px 12px;
  border:1px solid var(--border2); border-radius:6px;
  font-family:'Space Grotesk',sans-serif; font-size:13.5px;
  color:var(--text); background:var(--bg2); outline:none;
  transition:border-color 0.15s;
}
.modal input:focus, .modal select:focus, .modal textarea:focus { border-color:var(--accent); box-shadow:0 0 0 3px rgba(0,212,255,0.1); }
.modal textarea { resize:vertical; min-height:80px; }
.modal input[type="password"] { font-family:'JetBrains Mono',monospace; letter-spacing:0.1em; }
.modal-actions { display:flex; gap:10px; margin-top:24px; justify-content:flex-end; }
.mbtn-p { background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#000; border:none; padding:9px 22px; border-radius:7px; font-family:'Space Grotesk',sans-serif; font-size:13.5px; font-weight:700; cursor:pointer; transition:all 0.2s; }
.mbtn-p:hover { transform:translateY(-1px); box-shadow:0 4px 14px rgba(0,212,255,0.3); }
.mbtn-s { background:transparent; color:var(--text2); border:1px solid var(--border2); padding:9px 22px; border-radius:7px; font-family:'Space Grotesk',sans-serif; font-size:13.5px; cursor:pointer; transition:all 0.15s; }
.mbtn-s:hover { border-color:var(--border2); color:var(--text); }

/* Login modal special */
.login-modal-logo { text-align:center; margin-bottom:20px; }
.login-modal-logo .lmb { display:inline-flex; align-items:center; gap:10px; }
.login-modal-logo .lm-icon { width:44px; height:44px; background:linear-gradient(135deg,var(--accent),var(--accent2)); border-radius:12px; display:flex; align-items:center; justify-content:center; box-shadow:0 0 20px rgba(0,212,255,0.3); }
.login-modal-logo .lm-icon svg { width:24px; height:24px; }
.login-modal-logo .lm-text { font-family:'JetBrains Mono',monospace; font-size:16px; font-weight:600; color:var(--text); }
.login-modal-logo .lm-text span { color:var(--accent); }
.login-desc { font-size:13px; color:var(--text3); text-align:center; margin-bottom:4px; }

.error-msg { background:rgba(244,63,94,0.1); border:1px solid rgba(244,63,94,0.3); color:var(--rose); font-size:12.5px; padding:8px 12px; border-radius:6px; margin-top:10px; display:none; }
.error-msg.show { display:block; }

/* Instructor apply modal */
.inst-benefit { display:flex; gap:8px; padding:10px 14px; background:rgba(245,158,11,0.06); border:1px solid rgba(245,158,11,0.2); border-radius:8px; margin-bottom:14px; font-size:13px; color:var(--text2); }
.inst-benefit .ib-ico { font-size:18px; flex-shrink:0; }

/* Success screen */
.success-screen { text-align:center; padding:10px 0; }
.success-icon { font-size:52px; margin-bottom:16px; }
.success-screen h3 { font-family:'Outfit',sans-serif; font-size:20px; font-weight:800; margin-bottom:8px; }
.success-screen p { font-size:13.5px; color:var(--text2); max-width:360px; margin:0 auto; }

/* User dropdown */
.user-menu {
  position:fixed; z-index:600;
  background:var(--bg1); border:1px solid var(--border2);
  border-radius:10px; min-width:220px;
  box-shadow:0 16px 48px rgba(0,0,0,0.4);
  display:none;
}
.user-menu.open { display:block; animation:mIn 0.18s ease; }
.um-header { padding:14px 16px; border-bottom:1px solid var(--border); }
.um-name { font-size:14px; font-weight:700; }
.um-email { font-size:12px; color:var(--text3); margin-top:1px; }
.um-item {
  display:flex; align-items:center; gap:10px;
  padding:10px 16px; cursor:pointer;
  font-size:13.5px; color:var(--text2); transition:all 0.15s;
}
.um-item:hover { background:var(--bg2); color:var(--text); }
.um-item svg { width:14px; height:14px; flex-shrink:0; }
.um-item.danger { color:var(--rose); }
.um-item.danger:hover { background:rgba(244,63,94,0.08); }
.um-sep { height:1px; background:var(--border); }

/* Toast */
.toast { position:fixed; bottom:22px; right:22px; background:var(--bg2); border:1px solid var(--border2); color:var(--text); font-size:13px; font-weight:600; padding:10px 18px; border-radius:8px; box-shadow:0 8px 28px rgba(0,0,0,0.4); display:flex; align-items:center; gap:8px; opacity:0; transform:translateY(10px); transition:all 0.3s; z-index:900; pointer-events:none; }
.toast.show { opacity:1; transform:translateY(0); }
.toast.green { border-left:3px solid var(--green); }
.toast.cyan  { border-left:3px solid var(--accent); }
.toast.amber { border-left:3px solid var(--amber); }
.toast.red   { border-left:3px solid var(--rose); }

/* Edit fab */
.edit-fab { position:fixed; bottom:22px; left:calc(var(--sidebar-w) + 22px); display:none; align-items:center; gap:10px; background:var(--bg2); border:1px solid var(--accent); color:var(--accent); padding:9px 16px; border-radius:30px; box-shadow:0 0 20px rgba(0,212,255,0.2); z-index:200; font-size:12.5px; font-weight:700; font-family:'JetBrains Mono',monospace; }
body.edit-mode .edit-fab { display:flex; }
.edit-fab button { background:rgba(0,212,255,0.1); border:1px solid rgba(0,212,255,0.3); color:var(--accent); padding:3px 10px; border-radius:20px; cursor:pointer; font-family:'Space Grotesk',sans-serif; font-size:12px; font-weight:600; }

/* Become instructor banner */
.become-instructor-banner {
  background:linear-gradient(135deg,rgba(245,158,11,0.08),rgba(245,158,11,0.03));
  border:1px solid rgba(245,158,11,0.2); border-radius:10px;
  padding:18px 22px; margin-bottom:24px;
  display:flex; align-items:center; gap:16px;
}
.bib-ico { font-size:32px; flex-shrink:0; }
.bib-text h4 { font-size:15px; font-weight:700; color:var(--amber); }
.bib-text p { font-size:13px; color:var(--text3); margin-top:2px; }
.bib-btn { margin-left:auto; flex-shrink:0; padding:8px 18px; border-radius:7px; background:linear-gradient(135deg,var(--amber),#d97706); border:none; color:#000; font-weight:700; font-size:13px; font-family:'Space Grotesk',sans-serif; cursor:pointer; transition:all 0.2s; white-space:nowrap; }
.bib-btn:hover { transform:translateY(-1px); box-shadow:0 4px 14px rgba(245,158,11,0.35); }

/* Section label */
.sec-lbl { font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:0.12em; color:var(--text3); margin-bottom:14px; padding-bottom:8px; border-bottom:1px solid var(--border); }

/* Glow colors for providers */
.glow-aws   { box-shadow:0 0 0 1px rgba(255,153,0,0.2); }
.glow-gcp   { box-shadow:0 0 0 1px rgba(66,133,244,0.2); }
.glow-azure { box-shadow:0 0 0 1px rgba(0,120,212,0.2); }
.glow-m365  { box-shadow:0 0 0 1px rgba(216,59,1,0.2); }
.glow-comptia { box-shadow:0 0 0 1px rgba(200,32,42,0.2); }
.glow-other { box-shadow:0 0 0 1px rgba(139,92,246,0.2); }

.course-card:hover.glow-aws   { box-shadow:0 8px 32px rgba(255,153,0,0.1),0 0 0 1px rgba(255,153,0,0.3); }
.course-card:hover.glow-gcp   { box-shadow:0 8px 32px rgba(66,133,244,0.1),0 0 0 1px rgba(66,133,244,0.3); }
.course-card:hover.glow-azure { box-shadow:0 8px 32px rgba(0,120,212,0.1),0 0 0 1px rgba(0,120,212,0.3); }
.course-card:hover.glow-m365  { box-shadow:0 8px 32px rgba(216,59,1,0.1),0 0 0 1px rgba(216,59,1,0.3); }
.course-card:hover.glow-comptia { box-shadow:0 8px 32px rgba(200,32,42,0.1),0 0 0 1px rgba(200,32,42,0.3); }
.course-card:hover.glow-other { box-shadow:0 8px 32px rgba(139,92,246,0.1),0 0 0 1px rgba(139,92,246,0.3); }
</style>
</head>
<body>

<!-- ══════ HEADER ══════ -->
<header>
  <div class="logo-wrap" onclick="showView('home')">
    <div class="logo-mark">
      <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5">
        <polyline points="16 18 22 12 16 6"/>
        <polyline points="8 6 2 12 8 18"/>
      </svg>
    </div>
    <span class="logo-text">codethebox<span>.dev</span></span>
  </div>
  <div class="hdr-divider"></div>
  <nav class="hdr-nav">
    <button class="hdr-nav-btn" id="navCatalog" onclick="showView('catalog')">Catalog</button>
    <button class="hdr-nav-btn" id="navCourse" style="display:none" onclick="showView('course')">Course</button>
  </nav>

  <div class="hdr-right">
    <div class="hdr-search">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      <input type="text" placeholder="Search courses, labs...">
    </div>

    <div id="userChipWrap">
      <!-- populated by JS -->
    </div>
  </div>
</header>

<!-- User dropdown -->
<div class="user-menu" id="userMenu">
  <div class="um-header">
    <div class="um-name" id="umName">Guest</div>
    <div class="um-email" id="umEmail">Not signed in</div>
  </div>
  <div class="um-item" onclick="openModal('loginModal')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
    Sign In / Admin Login
  </div>
  <div class="um-item" id="umInstructorItem" onclick="openModal('instructorApplyModal')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
    Become an Instructor
  </div>
  <div class="um-sep"></div>
  <div class="um-item" id="umManageItem" style="display:none" onclick="showView('manager')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
    Manage Portal
  </div>
  <div class="um-item danger" id="umLogoutItem" style="display:none" onclick="logout()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
    Sign Out
  </div>
</div>

<!-- ══════════════════ VIEWS ══════════════════ -->

<!-- HOME -->
<div id="homeView" class="view active">
  <div class="hero">
    <div class="hero-bg"></div>
    <div class="hero-grid"></div>
    <div class="hero-glow"></div>
    <div class="hero-content">
      <div class="hero-badge">✦ Multi-Cloud Certification Platform</div>
      <h1>Code your path to<br><em>cloud mastery</em></h1>
      <p>Structured learning paths, hands-on labs, and expert-curated content for AWS, Google Cloud, Azure, Microsoft 365, CompTIA, and more.</p>
      <div class="hero-actions">
        <button class="btn-primary" onclick="showView('catalog')">
          Explore Courses
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </button>
        <button class="btn-outline" onclick="openModal('loginModal')">Sign In</button>
      </div>
      <div class="hero-providers">
        <span>Covering:</span>
        <div class="provider-logos">
          <span class="plogo aws">AWS</span>
          <span class="plogo gcp">GCP</span>
          <span class="plogo azure">Azure</span>
          <span class="plogo m365">M365</span>
          <span class="plogo comptia">CompTIA</span>
          <span class="plogo" style="color:var(--text3)">+ more</span>
        </div>
      </div>
    </div>
  </div>
  <div class="stats-strip">
    <div class="stat-cell"><div class="stat-num" id="hStat1">20+</div><div class="stat-label">Courses</div></div>
    <div class="stat-cell"><div class="stat-num">100+</div><div class="stat-label">Modules</div></div>
    <div class="stat-cell"><div class="stat-num">80+</div><div class="stat-label">Hands-on Labs</div></div>
    <div class="stat-cell"><div class="stat-num">5</div><div class="stat-label">Cloud Providers</div></div>
  </div>
</div>

<!-- CATALOG -->
<div id="catalogView" class="view">
  <div class="catalog-header">
    <h1>Course Catalog</h1>
    <p>Browse certifications across major cloud providers and technology platforms</p>
  </div>
  <div class="provider-tabs" id="providerTabs">
    <button class="ptab all active" data-p="all" onclick="filterProvider('all',this)"><span class="ptab-dot" style="background:var(--accent)"></span>All</button>
    <button class="ptab aws" data-p="AWS" onclick="filterProvider('AWS',this)"><span class="ptab-dot" style="background:var(--aws)"></span>Amazon AWS</button>
    <button class="ptab gcp" data-p="GCP" onclick="filterProvider('GCP',this)"><span class="ptab-dot" style="background:var(--gcp)"></span>Google Cloud</button>
    <button class="ptab azure" data-p="Azure" onclick="filterProvider('Azure',this)"><span class="ptab-dot" style="background:var(--azure)"></span>Microsoft Azure</button>
    <button class="ptab m365" data-p="M365" onclick="filterProvider('M365',this)"><span class="ptab-dot" style="background:var(--m365)"></span>Microsoft 365</button>
    <button class="ptab comptia" data-p="CompTIA" onclick="filterProvider('CompTIA',this)"><span class="ptab-dot" style="background:var(--comptia)"></span>CompTIA</button>
    <button class="ptab more" data-p="Other" onclick="filterProvider('Other',this)"><span class="ptab-dot" style="background:var(--violet)"></span>More</button>
  </div>
  <div class="level-row">
    <span>Level:</span>
    <button class="lvl-btn all active" onclick="filterLevel('all',this)">All</button>
    <button class="lvl-btn Fundamentals" onclick="filterLevel('Fundamentals',this)">Fundamentals</button>
    <button class="lvl-btn Associate" onclick="filterLevel('Associate',this)">Associate</button>
    <button class="lvl-btn Professional" onclick="filterLevel('Professional',this)">Professional</button>
    <button class="lvl-btn Expert" onclick="filterLevel('Expert',this)">Expert</button>
    <button class="lvl-btn Specialty" onclick="filterLevel('Specialty',this)">Specialty</button>
  </div>
  <div class="courses-grid" id="coursesGrid"></div>
</div>

<!-- COURSE -->
<div id="courseView" class="view">
  <div class="c-sidebar">
    <div class="c-sidebar-hdr">
      <span class="csb-id" id="sbId">AZ-900</span>
      <div class="csb-title" id="sbTitle">Course Title</div>
      <div class="csb-prog">
        <div class="prog-bar"><div class="prog-fill" id="sbProg" style="width:0%"></div></div>
        <span id="sbPct">0%</span>
      </div>
    </div>
    <div class="module-list" id="moduleList"></div>
  </div>
  <div class="c-main">
    <div class="content-area" id="contentArea"></div>
    <div class="c-toc">
      <div class="toc-lbl">On this page</div>
      <nav id="pageTOC"></nav>
    </div>
  </div>
</div>

<!-- MANAGER -->
<div id="managerView" class="view">
  <div class="mgr-hdr">
    <h1>⚙ Portal Management</h1>
    <p>Manage courses, users, and instructor requests — <span style="color:var(--accent);font-family:'JetBrains Mono',monospace;font-size:12px">savi.toy@codethebox.dev</span></p>
    <div class="mgr-tabs">
      <button class="m-tab active" onclick="switchMgrTab('courses',this)">Courses</button>
      <button class="m-tab" onclick="switchMgrTab('users',this)">Users</button>
      <button class="m-tab" onclick="switchMgrTab('requests',this)">Instructor Requests</button>
    </div>
  </div>
  <div class="mgr-body">
    <div id="mgrCourses">
      <div style="display:flex;gap:10px;margin-bottom:18px">
        <button class="mbtn-p" onclick="openModal('addCourseModal')">+ New Course</button>
      </div>
      <div class="mgr-grid" id="mgrCoursesGrid"></div>
    </div>
    <div id="mgrUsers" style="display:none">
      <div style="display:flex;gap:10px;margin-bottom:18px">
        <button class="mbtn-p" onclick="openModal('addUserModal')">+ Add User</button>
      </div>
      <table class="perm-table" id="permTable"></table>
    </div>
    <div id="mgrRequests" style="display:none">
      <div class="sec-lbl">Instructor Applications</div>
      <table class="perm-table" id="requestsTable"></table>
    </div>
  </div>
</div>

<!-- FAB -->
<div class="edit-fab">
  <span>✏ EDIT MODE</span>
  <button onclick="toggleEdit(false)">Exit</button>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- ══════════════════════════════════════
   MODALS
══════════════════════════════════════ -->

<!-- LOGIN / ADMIN -->
<div class="modal-overlay" id="loginModal">
  <div class="modal" style="max-width:400px">
    <div class="login-modal-logo">
      <div class="lmb">
        <div class="lm-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
        </div>
        <span class="lm-text">codethebox<span>.dev</span></span>
      </div>
    </div>
    <div class="login-desc">Sign in to access your courses and progress</div>
    <div class="login-desc" style="color:var(--accent);font-size:11.5px;margin-top:4px;font-family:'JetBrains Mono',monospace">Admin: savi.toy@codethebox.dev</div>
    <label>Email</label>
    <input type="email" id="loginEmail" placeholder="your@email.com">
    <label>Password</label>
    <input type="password" id="loginPass" placeholder="••••••••">
    <div class="error-msg" id="loginError">Invalid email or password. Try again.</div>
    <div style="font-size:12px;color:var(--text3);margin-top:12px;text-align:center">
      New here? You're automatically a <strong style="color:var(--green)">Student</strong> when you sign in.<br>
      <span style="cursor:pointer;color:var(--amber)" onclick="closeModal('loginModal');openModal('instructorApplyModal')">Want to become an Instructor?</span>
    </div>
    <div class="modal-actions">
      <button class="mbtn-s" onclick="closeModal('loginModal')">Cancel</button>
      <button class="mbtn-p" onclick="doLogin()">Sign In</button>
    </div>
  </div>
</div>

<!-- ADMIN CONFIRM (extra security) -->
<div class="modal-overlay" id="adminConfirmModal">
  <div class="modal" style="max-width:380px">
    <div style="text-align:center;margin-bottom:16px;font-size:32px">👑</div>
    <h3 style="text-align:center">Admin Access</h3>
    <div style="font-size:13px;color:var(--text3);text-align:center;margin-bottom:4px">Enter admin password to unlock full portal management</div>
    <label>Admin Password</label>
    <input type="password" id="adminPass" placeholder="••••••••" onkeydown="if(event.key==='Enter')doAdminConfirm()">
    <div class="error-msg" id="adminError">Incorrect admin password.</div>
    <div class="modal-actions">
      <button class="mbtn-s" onclick="closeModal('adminConfirmModal')">Cancel</button>
      <button class="mbtn-p" onclick="doAdminConfirm()">Unlock Admin</button>
    </div>
  </div>
</div>

<!-- BECOME INSTRUCTOR -->
<div class="modal-overlay" id="instructorApplyModal">
  <div class="modal">
    <h3>🎓 Become an Instructor</h3>
    <div class="inst-benefit">
      <span class="ib-ico">✨</span>
      <div>Your application will be reviewed and a confirmation sent to <strong style="color:var(--amber)">savi.toy@codethebox.dev</strong>. Approved instructors can create and manage course content.</div>
    </div>
    <label>Full Name</label><input type="text" id="appName" placeholder="Your full name">
    <label>Email Address</label><input type="email" id="appEmail" placeholder="your@email.com">
    <label>LinkedIn / Portfolio URL</label><input type="text" id="appLinkedin" placeholder="https://linkedin.com/in/...">
    <label>Expertise / Certifications</label>
    <input type="text" id="appCerts" placeholder="e.g. AWS SAA, GCP ACE, Azure AZ-104">
    <label>Why do you want to teach? (briefly)</label>
    <textarea id="appWhy" placeholder="Share your motivation and teaching experience..."></textarea>
    <div id="appSuccess" style="display:none">
      <div class="success-screen">
        <div class="success-icon">📧</div>
        <h3>Application Submitted!</h3>
        <p>Your request has been sent to <strong style="color:var(--amber)">savi.toy@codethebox.dev</strong>. You'll hear back within 2–3 business days.</p>
      </div>
    </div>
    <div class="modal-actions" id="appActions">
      <button class="mbtn-s" onclick="closeModal('instructorApplyModal')">Cancel</button>
      <button class="mbtn-p" onclick="submitInstructorApp()">Submit Application</button>
    </div>
  </div>
</div>

<!-- ADD COURSE -->
<div class="modal-overlay" id="addCourseModal">
  <div class="modal">
    <h3>New Course</h3>
    <label>Certification ID / Code</label><input type="text" id="nc-id" placeholder="e.g. SAA-C03, AZ-104, N+">
    <label>Course Name</label><input type="text" id="nc-name" placeholder="e.g. AWS Solutions Architect Associate">
    <label>Provider</label>
    <select id="nc-provider">
      <option value="AWS">Amazon AWS</option>
      <option value="GCP">Google Cloud</option>
      <option value="Azure">Microsoft Azure</option>
      <option value="M365">Microsoft 365</option>
      <option value="CompTIA">CompTIA</option>
      <option value="Other">Other</option>
    </select>
    <label>Level</label>
    <select id="nc-level">
      <option>Fundamentals</option><option>Associate</option><option>Professional</option><option>Expert</option><option>Specialty</option>
    </select>
    <label>Description</label><textarea id="nc-desc" placeholder="Course description..."></textarea>
    <label>Est. Duration</label><input type="text" id="nc-dur" placeholder="e.g. 40 hours">
    <div class="modal-actions">
      <button class="mbtn-s" onclick="closeModal('addCourseModal')">Cancel</button>
      <button class="mbtn-p" onclick="addCourse()">Create Course</button>
    </div>
  </div>
</div>

<!-- ADD MODULE -->
<div class="modal-overlay" id="addModuleModal">
  <div class="modal">
    <h3>New Module</h3>
    <label>Module Title</label><input type="text" id="nm-title" placeholder="e.g. EC2 and Compute Services">
    <div class="modal-actions">
      <button class="mbtn-s" onclick="closeModal('addModuleModal')">Cancel</button>
      <button class="mbtn-p" onclick="addModule()">Add Module</button>
    </div>
  </div>
</div>

<!-- ADD PAGE -->
<div class="modal-overlay" id="addPageModal">
  <div class="modal">
    <h3>Add Content</h3>
    <label>Title</label><input type="text" id="ap-title" placeholder="e.g. Introduction to S3">
    <label>Type</label>
    <select id="ap-type">
      <option value="doc">📄 Documentation Page</option>
      <option value="lab">🧪 Hands-on Lab</option>
      <option value="video">▶ Video Lesson</option>
    </select>
    <label>Video / Resource URL (optional)</label>
    <input type="text" id="ap-url" placeholder="https://youtube.com/watch?v=...">
    <label>Duration</label><input type="text" id="ap-dur" placeholder="e.g. 20 min">
    <div class="modal-actions">
      <button class="mbtn-s" onclick="closeModal('addPageModal')">Cancel</button>
      <button class="mbtn-p" onclick="addPage()">Create</button>
    </div>
  </div>
</div>

<!-- VIDEO EMBED -->
<div class="modal-overlay" id="addVideoModal">
  <div class="modal">
    <h3>Embed Video</h3>
    <label>YouTube URL</label><input type="text" id="vb-url" placeholder="https://www.youtube.com/watch?v=...">
    <label>Caption</label><input type="text" id="vb-cap" placeholder="Optional caption">
    <div class="modal-actions">
      <button class="mbtn-s" onclick="closeModal('addVideoModal')">Cancel</button>
      <button class="mbtn-p" onclick="commitVideo()">Embed</button>
    </div>
  </div>
</div>

<!-- IMAGE -->
<div class="modal-overlay" id="addImageModal">
  <div class="modal">
    <h3>Add Image</h3>
    <label>Image URL</label><input type="text" id="ib-url" placeholder="https://...">
    <label>Caption</label><input type="text" id="ib-cap" placeholder="Optional caption">
    <div class="modal-actions">
      <button class="mbtn-s" onclick="closeModal('addImageModal')">Cancel</button>
      <button class="mbtn-p" onclick="commitImage()">Add Image</button>
    </div>
  </div>
</div>

<!-- LINK -->
<div class="modal-overlay" id="addLinkModal">
  <div class="modal">
    <h3>Add Link Card</h3>
    <label>URL</label><input type="text" id="lb-url" placeholder="https://...">
    <label>Title</label><input type="text" id="lb-title" placeholder="Link title">
    <label>Description</label><input type="text" id="lb-desc" placeholder="Brief description">
    <div class="modal-actions">
      <button class="mbtn-s" onclick="closeModal('addLinkModal')">Cancel</button>
      <button class="mbtn-p" onclick="commitLink()">Add Link</button>
    </div>
  </div>
</div>

<!-- ADD USER -->
<div class="modal-overlay" id="addUserModal">
  <div class="modal">
    <h3>Add User</h3>
    <label>Full Name</label><input type="text" id="au-name" placeholder="Full name">
    <label>Email</label><input type="text" id="au-email" placeholder="user@example.com">
    <label>Role</label>
    <select id="au-role">
      <option value="student">Student</option>
      <option value="instructor">Instructor</option>
      <option value="admin">Admin</option>
    </select>
    <div class="modal-actions">
      <button class="mbtn-s" onclick="closeModal('addUserModal')">Cancel</button>
      <button class="mbtn-p" onclick="addUser()">Add User</button>
    </div>
  </div>
</div>

<script>
// ═══════════════════════════════════════════════════
//   STATE
// ═══════════════════════════════════════════════════
const ADMIN_EMAIL    = 'savi.toy@codethebox.dev';
const ADMIN_PASSWORD = 'codethebox@admin2024';
const STUDENT_PASS   = 'student123'; // demo password for any student

let S = {
  user: null, // null = guest
  role: 'guest', // guest | student | instructor | admin
  editMode: false,
  curCourseId: null,
  curPageKey: null,
  addingToMod: null,
  filterProvider: 'all',
  filterLevel: 'all',
  completedSteps: {},

  instructorRequests: [
    { id:1, name:'Kamonwan Phetcharat', email:'kamonwan@example.com', linkedin:'linkedin.com/in/kamonwan', certs:'AWS SAA, Azure AZ-104', why:'5 years cloud architect experience, want to give back to community.', status:'pending', date:'2026-02-20' },
    { id:2, name:'Nuttapong Srisuk', email:'nutt@example.com', linkedin:'linkedin.com/in/nutt', certs:'CompTIA A+, Network+, Security+', why:'IT trainer with 3 years classroom experience.', status:'approved', date:'2026-02-15' },
  ],

  users: [
    { id:1, name:'Samet (Admin)', email:ADMIN_EMAIL, role:'admin', joined:'2025-01-01' },
    { id:2, name:'Kamonwan P.', email:'kamonwan@example.com', role:'instructor', joined:'2026-02-15' },
    { id:3, name:'Nuttapong S.', email:'nutt@example.com', role:'student', joined:'2026-01-10' },
    { id:4, name:'Pimchanok R.', email:'pim@example.com', role:'student', joined:'2026-02-01' },
  ],

  courses: [
    // AWS
    { id:'SAA-C03', name:'AWS Solutions Architect Associate', provider:'AWS', level:'Associate', desc:'Design and deploy scalable, highly available, and fault-tolerant systems on AWS. Covers EC2, S3, RDS, VPC, IAM, and core architecture patterns.', duration:'45 hours', progress:65, modules:[
      { title:'AWS Core Services', col:'#FF9900', pages:[
        { title:'EC2 & Compute', type:'doc', dur:'20 min', url:'', blocks:[
          {t:'heading',c:'Amazon EC2 – Elastic Compute Cloud'},
          {t:'text',c:'EC2 provides resizable compute capacity in the cloud. Choose from 500+ instance types optimized for different use cases: compute, memory, storage, and GPU workloads.'},
          {t:'note',c:'For the SAA-C03 exam, know the difference between On-Demand, Reserved, Spot, and Dedicated instance pricing models.'},
          {t:'code',c:'# Launch an EC2 instance via AWS CLI\naws ec2 run-instances \\\n  --image-id ami-0abcdef1234567890 \\\n  --instance-type t3.micro \\\n  --key-name MyKeyPair \\\n  --security-group-ids sg-12345678 \\\n  --subnet-id subnet-12345678'},
        ]},
        { title:'S3 & Object Storage', type:'doc', dur:'18 min', url:'', blocks:[
          {t:'heading',c:'Amazon S3 – Simple Storage Service'},
          {t:'text',c:'S3 provides object storage with 99.999999999% (11 9s) durability. Objects are stored in buckets and can range from 0 bytes to 5TB per object.'},
          {t:'warning',c:'S3 bucket names must be globally unique across all AWS accounts. Plan your naming convention carefully.'},
        ]},
        { title:'Lab: Build 3-Tier Architecture', type:'lab', dur:'90 min', url:'', blocks:[
          {t:'lab-meta',duration:'90 min',difficulty:'Intermediate',points:150},
          {t:'heading',c:'Objectives'},
          {t:'text',c:'Deploy a highly available 3-tier web application using EC2 (web/app), RDS (database), and S3 (static assets) with an Application Load Balancer.'},
          {t:'step',n:1,title:'Create VPC and Subnets',c:'Create a VPC with CIDR 10.0.0.0/16. Add 2 public subnets (web tier) and 2 private subnets (app/db tier) across 2 AZs.'},
          {t:'step',n:2,title:'Launch EC2 Instances',c:'Deploy 2 EC2 t3.micro instances (Amazon Linux 2023) in public subnets with Apache/Nginx installed via User Data script.'},
          {t:'step',n:3,title:'Configure Application Load Balancer',c:'Create an ALB in public subnets, add a target group with your EC2 instances, and configure listener on port 80.'},
          {t:'step',n:4,title:'Set Up RDS',c:'Deploy an RDS MySQL 8.0 db.t3.micro instance in the private subnet group. Enable Multi-AZ for high availability.'},
        ]},
      ]},
      { title:'Networking & Security', col:'#FF9900', pages:[
        { title:'VPC Deep Dive', type:'doc', dur:'25 min', url:'', blocks:[
          {t:'heading',c:'Amazon VPC Architecture'},
          {t:'text',c:'A Virtual Private Cloud (VPC) is a logically isolated section of the AWS Cloud. Each VPC spans all AZs in a region and can be subdivided into subnets per AZ.'},
          {t:'code',c:'# Create VPC\naws ec2 create-vpc --cidr-block 10.0.0.0/16\n\n# Create Internet Gateway\naws ec2 create-internet-gateway\n\n# Attach to VPC\naws ec2 attach-internet-gateway \\\n  --internet-gateway-id igw-xxx \\\n  --vpc-id vpc-xxx'},
        ]},
      ]},
    ]},
    { id:'CLF-C02', name:'AWS Cloud Practitioner', provider:'AWS', level:'Fundamentals', desc:'Entry-level certification covering fundamental AWS Cloud concepts, services, and terminology.', duration:'12 hours', progress:0, modules:[
      { title:'Cloud Fundamentals', col:'#FF9900', pages:[
        { title:'What is AWS?', type:'doc', dur:'15 min', url:'', blocks:[{t:'heading',c:'Amazon Web Services Overview'},{t:'text',c:'AWS is the world\'s most comprehensive and broadly adopted cloud platform, offering 200+ fully featured services from data centers globally.'}]},
        { title:'AWS Global Infrastructure', type:'video', dur:'12 min', url:'https://www.youtube.com/embed/a9__D53WsUs', blocks:[{t:'heading',c:'AWS Global Infrastructure'},{t:'video',url:'https://www.youtube.com/embed/a9__D53WsUs',cap:'AWS Global Infrastructure Overview'},{t:'text',c:'AWS operates 31 regions, 99 Availability Zones, and 400+ Points of Presence worldwide.'}]},
      ]},
    ]},

    // GCP
    { id:'ACE', name:'Google Cloud Associate Engineer', provider:'GCP', level:'Associate', desc:'Deploy applications, monitor operations, and manage enterprise solutions on Google Cloud Platform.', duration:'40 hours', progress:20, modules:[
      { title:'GCP Core Infrastructure', col:'#4285F4', pages:[
        { title:'Compute Engine & GKE', type:'doc', dur:'22 min', url:'', blocks:[
          {t:'heading',c:'Google Compute Engine'},
          {t:'text',c:'Compute Engine delivers configurable virtual machines running in Google\'s data centers. GKE (Google Kubernetes Engine) provides managed Kubernetes for containerized workloads.'},
          {t:'tip',c:'For ACE exam, know when to use Compute Engine vs App Engine vs Cloud Run vs GKE — this is heavily tested.'},
        ]},
        { title:'Lab: Deploy on GKE', type:'lab', dur:'60 min', url:'', blocks:[
          {t:'lab-meta',duration:'60 min',difficulty:'Intermediate',points:100},
          {t:'heading',c:'Deploy a containerized app to GKE'},
          {t:'step',n:1,title:'Create GKE Cluster',c:'Run: gcloud container clusters create my-cluster --zone us-central1-a --num-nodes=3'},
          {t:'step',n:2,title:'Deploy Application',c:'Create a deployment: kubectl create deployment hello-app --image=gcr.io/google-samples/hello-app:1.0'},
          {t:'step',n:3,title:'Expose Service',c:'Run: kubectl expose deployment hello-app --type=LoadBalancer --port 80 --target-port 8080'},
        ]},
      ]},
    ]},
    { id:'PCA', name:'Google Cloud Professional Architect', provider:'GCP', level:'Professional', desc:'Design, develop, and manage robust, secure, scalable, highly available, and dynamic solutions on GCP.', duration:'60 hours', progress:0, modules:[
      { title:'Solution Design', col:'#4285F4', pages:[
        { title:'Architecture Patterns', type:'doc', dur:'30 min', url:'', blocks:[{t:'heading',c:'GCP Architecture Patterns'},{t:'text',c:'Google Cloud Well-Architected Framework covers operational excellence, security, reliability, performance efficiency, and cost optimization.'}]},
      ]},
    ]},

    // Azure
    { id:'AZ-900', name:'Azure Fundamentals', provider:'Azure', level:'Fundamentals', desc:'Foundation-level knowledge of cloud services and Microsoft Azure. Perfect for non-technical roles and career changers.', duration:'8 hours', progress:35, modules:[
      { title:'Cloud Concepts', col:'#0078D4', pages:[
        { title:'What is Cloud Computing?', type:'doc', dur:'10 min', url:'', blocks:[
          {t:'heading',c:'Cloud Computing Fundamentals'},
          {t:'text',c:'Cloud computing delivers computing services over the internet—servers, storage, databases, networking, software, analytics—enabling faster innovation and flexible resources.'},
          {t:'note',c:'AZ-900 covers the three cloud models: Public, Private, and Hybrid — and three service models: IaaS, PaaS, and SaaS.'},
        ]},
        { title:'Azure Portal Tour', type:'video', dur:'15 min', url:'https://www.youtube.com/embed/NKEFWyIE3MU', blocks:[
          {t:'heading',c:'Navigating the Azure Portal'},
          {t:'video',url:'https://www.youtube.com/embed/NKEFWyIE3MU',cap:'Microsoft Learn: Azure Portal Overview'},
          {t:'text',c:'The Azure Portal is a web-based console for managing Azure resources. Learn the key navigation elements before your exam.'},
        ]},
        { title:'Lab: Create Your First VM', type:'lab', dur:'30 min', url:'', blocks:[
          {t:'lab-meta',duration:'30 min',difficulty:'Beginner',points:50},
          {t:'heading',c:'Deploy an Azure Virtual Machine'},
          {t:'step',n:1,title:'Sign in to Azure Portal',c:'Navigate to portal.azure.com and sign in with your Microsoft account.'},
          {t:'step',n:2,title:'Create Resource Group',c:'Click Resource Groups → + Create → name it rg-az900-lab → select East US region.'},
          {t:'step',n:3,title:'Deploy VM',c:'Search Virtual Machines → + Create → select Windows Server 2022 → Standard_B2s → deploy.'},
        ]},
      ]},
    ]},
    { id:'AZ-104', name:'Azure Administrator', provider:'Azure', level:'Associate', desc:'Implement, manage, and monitor Azure infrastructure — identity, storage, compute, and virtual networks.', duration:'40 hours', progress:12, modules:[
      { title:'Identity & Access', col:'#0078D4', pages:[
        { title:'Entra ID Overview', type:'doc', dur:'20 min', url:'', blocks:[
          {t:'heading',c:'Microsoft Entra ID'},
          {t:'text',c:'Entra ID (formerly Azure AD) is Microsoft\'s cloud-based identity and access management service. Central to AZ-104 exam.'},
          {t:'warning',c:'Know the difference between Entra ID P1 (Conditional Access) and P2 (PIM, Identity Protection) licensing.'},
        ]},
      ]},
    ]},
    { id:'AZ-305', name:'Azure Solutions Architect Expert', provider:'Azure', level:'Expert', desc:'Design and implement cloud and hybrid solutions running on Azure — compute, network, storage, security.', duration:'56 hours', progress:0, modules:[
      { title:'Architecture Design', col:'#0078D4', pages:[
        { title:'Well-Architected Framework', type:'doc', dur:'28 min', url:'', blocks:[{t:'heading',c:'Azure WAF'},{t:'text',c:'Five pillars: Reliability, Security, Cost Optimization, Operational Excellence, Performance Efficiency. Every design decision must balance these pillars.'}]},
      ]},
    ]},

    // M365
    { id:'MS-900', name:'Microsoft 365 Fundamentals', provider:'M365', level:'Fundamentals', desc:'Demonstrate foundational-level knowledge of cloud services and Microsoft 365 productivity platform.', duration:'10 hours', progress:80, modules:[
      { title:'M365 Core Services', col:'#D83B01', pages:[
        { title:'Microsoft 365 Overview', type:'doc', dur:'15 min', url:'', blocks:[
          {t:'heading',c:'Microsoft 365 Platform'},
          {t:'text',c:'Microsoft 365 combines Office apps (Word, Excel, PowerPoint), Teams, SharePoint, Exchange, and cloud security in a unified subscription platform.'},
          {t:'card',h:'Key Licenses',c:'M365 Business Basic, Business Standard, Business Premium, E3, E5 — know the differences for MS-900.'},
        ]},
      ]},
    ]},
    { id:'MS-700', name:'Managing Microsoft Teams', provider:'M365', level:'Associate', desc:'Configure and manage Microsoft Teams for collaboration, meetings, calling, and Teams apps.', duration:'35 hours', progress:0, modules:[
      { title:'Teams Administration', col:'#D83B01', pages:[
        { title:'Teams Architecture', type:'doc', dur:'18 min', url:'', blocks:[{t:'heading',c:'Microsoft Teams Architecture'},{t:'text',c:'Teams is built on Microsoft 365 Groups, SharePoint Online, Exchange Online, and Azure AD. Understanding the underlying services is key for MS-700.'}]},
      ]},
    ]},

    // CompTIA
    { id:'CompTIA-A+', name:'CompTIA A+ Core 1 & 2', provider:'CompTIA', level:'Fundamentals', desc:'The industry-standard certification for IT technicians covering hardware, networking, troubleshooting, and operating systems.', duration:'25 hours', progress:0, modules:[
      { title:'Hardware & Networking', col:'#C8202A', pages:[
        { title:'PC Components', type:'doc', dur:'20 min', url:'', blocks:[
          {t:'heading',c:'Core Hardware Components'},
          {t:'text',c:'A+ covers CPUs, RAM (DDR4/DDR5), storage (NVMe SSD, SATA, HDD), motherboards, PSUs, and expansion cards. Know the physical connectors and form factors.'},
          {t:'note',c:'CompTIA A+ 220-1101 and 220-1102 are both required to earn the certification.'},
        ]},
      ]},
    ]},
    { id:'CompTIA-Sec+', name:'CompTIA Security+', provider:'CompTIA', level:'Associate', desc:'Globally trusted, vendor-neutral certification that validates core security skills and knowledge.', duration:'30 hours', progress:45, modules:[
      { title:'Threats & Vulnerabilities', col:'#C8202A', pages:[
        { title:'Malware Types', type:'doc', dur:'18 min', url:'', blocks:[
          {t:'heading',c:'Common Malware Types'},
          {t:'text',c:'Know the difference: Ransomware encrypts data for payment. Trojans disguise as legitimate software. Rootkits hide malicious activity. Spyware monitors user activity covertly.'},
          {t:'danger',c:'Zero-day exploits target unknown vulnerabilities — no patch exists yet. Mitigation relies on anomaly detection and behavior analysis.'},
        ]},
        { title:'Lab: Network Scanning', type:'lab', dur:'45 min', url:'', blocks:[
          {t:'lab-meta',duration:'45 min',difficulty:'Intermediate',points:75},
          {t:'heading',c:'Network Reconnaissance Lab'},
          {t:'step',n:1,title:'Install Nmap',c:'sudo apt install nmap (Linux) or download from nmap.org (Windows)'},
          {t:'step',n:2,title:'Basic Scan',c:'Run: nmap -sV 192.168.1.0/24 to discover hosts and services on your local network.'},
          {t:'step',n:3,title:'Analyze Results',c:'Identify open ports, services, and OS fingerprinting results. Document any unexpected open services.'},
        ]},
      ]},
    ]},
    { id:'CompTIA-Net+', name:'CompTIA Network+', provider:'CompTIA', level:'Associate', desc:'Vendor-neutral networking certification covering infrastructure, operations, and network security.', duration:'28 hours', progress:0, modules:[
      { title:'Network Fundamentals', col:'#C8202A', pages:[
        { title:'OSI & TCP/IP Models', type:'doc', dur:'22 min', url:'', blocks:[{t:'heading',c:'OSI and TCP/IP Reference Models'},{t:'text',c:'OSI 7-layer model: Physical, Data Link, Network, Transport, Session, Presentation, Application. TCP/IP collapses to 4 layers. Network+ heavily tests port numbers and protocols at each layer.'}]},
      ]},
    ]},

    // Other
    { id:'CKA', name:'Certified Kubernetes Administrator', provider:'Other', level:'Professional', desc:'Demonstrate competency in Kubernetes administration including installation, configuration, networking, storage, and security.', duration:'50 hours', progress:10, modules:[
      { title:'Kubernetes Core', col:'#326CE5', pages:[
        { title:'Pods & Workloads', type:'doc', dur:'25 min', url:'', blocks:[
          {t:'heading',c:'Kubernetes Workloads'},
          {t:'text',c:'Pods are the smallest deployable unit. Deployments manage stateless workloads, StatefulSets for stateful apps, DaemonSets for node-level agents, and Jobs/CronJobs for batch tasks.'},
          {t:'code',c:'# Create a deployment\nkubectl create deployment nginx --image=nginx --replicas=3\n\n# Expose via service\nkubectl expose deployment nginx --port=80 --type=LoadBalancer\n\n# Check status\nkubectl get pods,svc'},
        ]},
      ]},
    ]},
  ],
};

// ═══════════════════════════════════════════════════
//   PROVIDER CONFIG
// ═══════════════════════════════════════════════════
const PROVIDER = {
  AWS:     { color:'#FF9900', bg:'rgba(255,153,0,0.12)', glow:'glow-aws' },
  GCP:     { color:'#4285F4', bg:'rgba(66,133,244,0.12)', glow:'glow-gcp' },
  Azure:   { color:'#0078D4', bg:'rgba(0,120,212,0.12)', glow:'glow-azure' },
  M365:    { color:'#D83B01', bg:'rgba(216,59,1,0.12)', glow:'glow-m365' },
  CompTIA: { color:'#C8202A', bg:'rgba(200,32,42,0.12)', glow:'glow-comptia' },
  Other:   { color:'#8B5CF6', bg:'rgba(139,92,246,0.12)', glow:'glow-other' },
};

// ═══════════════════════════════════════════════════
//   AUTH
// ═══════════════════════════════════════════════════
function doLogin() {
  const email = document.getElementById('loginEmail').value.trim().toLowerCase();
  const pass  = document.getElementById('loginPass').value;
  const errEl = document.getElementById('loginError');

  if (email === ADMIN_EMAIL.toLowerCase()) {
    // Admin flow — ask for admin password
    closeModal('loginModal');
    document.getElementById('adminPass').value = '';
    document.getElementById('adminError').classList.remove('show');
    // store pending email
    S._pendingAdminEmail = email;
    openModal('adminConfirmModal');
    return;
  }

  // Demo: any email + 'student123' = student login
  if (pass === 'student123' && email.includes('@')) {
    S.user = { name: email.split('@')[0], email, role:'student' };
    S.role = 'student';
    closeModal('loginModal');
    errEl.classList.remove('show');
    updateUserUI();
    showToast('Welcome back! Signed in as Student 📖', 'green');
    return;
  }

  errEl.classList.add('show');
}

function doAdminConfirm() {
  const pass = document.getElementById('adminPass').value;
  const errEl = document.getElementById('adminError');

  if (pass === ADMIN_PASSWORD) {
    S.user = { name:'Samet (Admin)', email:ADMIN_EMAIL, role:'admin' };
    S.role = 'admin';
    S.editMode = true;
    document.body.classList.add('edit-mode');
    closeModal('adminConfirmModal');
    errEl.classList.remove('show');
    updateUserUI();
    showToast('👑 Admin access granted — full control enabled', 'amber');
  } else {
    errEl.classList.add('show');
  }
}

function logout() {
  S.user = null;
  S.role = 'guest';
  S.editMode = false;
  document.body.classList.remove('edit-mode');
  updateUserUI();
  closeUserMenu();
  showToast('Signed out successfully', 'cyan');
  if (S.currentView === 'manager') showView('catalog');
}

function updateUserUI() {
  const wrap = document.getElementById('userChipWrap');
  const menuBtn = document.getElementById('umManageItem');
  const logoutBtn = document.getElementById('umLogoutItem');
  const instItem = document.getElementById('umInstructorItem');

  if (!S.user) {
    // Guest
    wrap.innerHTML = `<button class="login-btn" onclick="openModal('loginModal')">Sign In</button>`;
    menuBtn.style.display = 'none';
    logoutBtn.style.display = 'none';
    instItem.style.display = '';
    document.getElementById('umName').textContent = 'Guest';
    document.getElementById('umEmail').textContent = 'Not signed in';
  } else {
    const roleIcon = { admin:'👑', instructor:'🎓', student:'📖' }[S.role];
    const initials = S.user.name.split(' ').map(w=>w[0]).join('').substring(0,2).toUpperCase();
    wrap.innerHTML = `<div class="user-chip" onclick="toggleUserMenu(event)">
      <div class="user-avatar ua-${S.role}">${initials}</div>
      <div class="uc-info">
        <span class="uc-name">${S.user.name.split(' ')[0]}</span>
        <span class="uc-role">${roleIcon} ${S.role.charAt(0).toUpperCase()+S.role.slice(1)}</span>
      </div>
      <div class="role-dot dot-${S.role}"></div>
    </div>`;
    document.getElementById('umName').textContent = S.user.name;
    document.getElementById('umEmail').textContent = S.user.email;
    menuBtn.style.display = S.role === 'admin' ? '' : 'none';
    logoutBtn.style.display = '';
    instItem.style.display = (S.role === 'student') ? '' : 'none';
  }
}

function toggleUserMenu(e) {
  e.stopPropagation();
  const chip = e.currentTarget.getBoundingClientRect();
  const menu = document.getElementById('userMenu');
  menu.style.top = (chip.bottom + 8) + 'px';
  menu.style.right = (window.innerWidth - chip.right) + 'px';
  menu.classList.toggle('open');
}

function closeUserMenu() { document.getElementById('userMenu').classList.remove('open'); }
document.addEventListener('click', closeUserMenu);

// ═══════════════════════════════════════════════════
//   INSTRUCTOR APPLICATION
// ═══════════════════════════════════════════════════
function submitInstructorApp() {
  const name   = document.getElementById('appName').value.trim();
  const email  = document.getElementById('appEmail').value.trim();
  const certs  = document.getElementById('appCerts').value.trim();
  const why    = document.getElementById('appWhy').value.trim();
  const linkedin = document.getElementById('appLinkedin').value.trim();
  if (!name || !email) { showToast('Please fill in name and email', 'amber'); return; }

  S.instructorRequests.push({
    id: Date.now(), name, email, linkedin, certs, why,
    status:'pending', date: new Date().toISOString().split('T')[0]
  });

  document.getElementById('appActions').style.display = 'none';
  document.getElementById('appSuccess').style.display = 'block';
  showToast('Application sent to savi.toy@codethebox.dev 📧', 'green');

  setTimeout(() => {
    closeModal('instructorApplyModal');
    document.getElementById('appActions').style.display = 'flex';
    document.getElementById('appSuccess').style.display = 'none';
  }, 3500);
}

// ═══════════════════════════════════════════════════
//   VIEW ROUTING
// ═══════════════════════════════════════════════════
function showView(v) {
  S.currentView = v;
  ['homeView','catalogView','courseView','managerView'].forEach(id => {
    document.getElementById(id).style.display = 'none';
    document.getElementById(id).classList.remove('active');
  });

  document.querySelectorAll('.hdr-nav-btn').forEach(b => b.classList.remove('active'));

  if (v === 'home') {
    document.getElementById('homeView').style.display = 'block';
    document.getElementById('homeView').classList.add('active');
    document.getElementById('navCatalog').style.display = '';
    document.getElementById('navCourse').style.display = 'none';
  } else if (v === 'catalog') {
    document.getElementById('catalogView').style.display = 'block';
    document.getElementById('catalogView').classList.add('active');
    document.getElementById('navCatalog').classList.add('active');
    document.getElementById('navCourse').style.display = 'none';
    renderCatalog();
  } else if (v === 'course') {
    document.getElementById('courseView').style.display = 'flex';
    document.getElementById('courseView').classList.add('active');
    document.getElementById('navCourse').style.display = '';
    document.getElementById('navCourse').classList.add('active');
    renderCourseView();
  } else if (v === 'manager') {
    if (S.role !== 'admin') { showToast('Admin access required', 'amber'); return; }
    document.getElementById('managerView').style.display = 'block';
    document.getElementById('managerView').classList.add('active');
    renderManager();
  }
}

// ═══════════════════════════════════════════════════
//   CATALOG
// ═══════════════════════════════════════════════════
let _pFilter = 'all', _lFilter = 'all';

function renderCatalog() {
  const grid = document.getElementById('coursesGrid');
  const filtered = S.courses.filter(c => {
    const pm = _pFilter === 'all' || c.provider === _pFilter;
    const lm = _lFilter === 'all' || c.level === _lFilter;
    return pm && lm;
  });

  grid.innerHTML = filtered.map(c => {
    const p = PROVIDER[c.provider] || PROVIDER.Other;
    const totalLabs = c.modules.reduce((s,m)=>s+m.pages.filter(pg=>pg.type==='lab').length,0);
    const totalMods = c.modules.length;
    return `<div class="course-card ${p.glow}" data-provider="${c.provider}" data-level="${c.level}" onclick="openCourse('${c.id}')">
      <div class="course-card::before" style="background:linear-gradient(90deg,${p.color},transparent)"></div>
      <div class="card-top">
        <div class="card-provider-row">
          <div class="provider-badge" style="color:${p.color};border-color:${p.color};background:${p.bg}">
            <span style="width:7px;height:7px;border-radius:50%;background:${p.color};display:inline-block"></span>
            ${c.provider === 'Other' ? (c.id.includes('CK')?'CNCF':'Other') : c.provider} · ${c.id}
          </div>
          <span class="level-badge lbg-${c.level}">${c.level}</span>
        </div>
        <h3>${c.name}</h3>
        <p>${c.desc}</p>
      </div>
      <div class="card-meta">
        <span class="cm"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>${totalMods} modules</span>
        <span class="cm"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 3H5a2 2 0 00-2 2v4m6-6h10a2 2 0 012 2v4M9 3v18m0 0h10a2 2 0 002-2V9M9 21H5a2 2 0 01-2-2V9m0 0h18"/></svg>${totalLabs} labs</span>
        <span class="cm"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>${c.duration}</span>
        <div class="card-progress">
          <div class="prog-bar"><div class="prog-fill" style="width:${c.progress}%;background:${p.color}"></div></div>
        </div>
      </div>
      <div class="card-footer">
        <button class="open-btn" style="color:${p.color}">
          ${c.progress>0?'Continue':'Start'}
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </button>
        <span class="cert-id">${c.id}</span>
      </div>
    </div>`;
  }).join('');
}

function filterProvider(p, btn) {
  _pFilter = p;
  document.querySelectorAll('.ptab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderCatalog();
}

function filterLevel(l, btn) {
  _lFilter = l;
  document.querySelectorAll('.lvl-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderCatalog();
}

function openCourse(id) {
  S.curCourseId = id;
  const c = S.courses.find(x=>x.id===id);
  if (c && c.modules[0] && c.modules[0].pages[0]) S.curPageKey = '0-0';
  showView('course');
}

// ═══════════════════════════════════════════════════
//   COURSE VIEW
// ═══════════════════════════════════════════════════
function renderCourseView() {
  const c = S.courses.find(x=>x.id===S.curCourseId);
  if (!c) return;
  const p = PROVIDER[c.provider] || PROVIDER.Other;

  const sid = document.getElementById('sbId');
  sid.textContent = c.id;
  sid.style.color = p.color;
  sid.style.borderColor = p.color;
  sid.style.background = p.bg;
  document.getElementById('sbTitle').textContent = c.name;
  document.getElementById('sbProg').style.width = c.progress + '%';
  document.getElementById('sbProg').style.background = p.color;
  document.getElementById('sbPct').textContent = c.progress + '%';

  renderModuleList(c);
  renderPageContent();
}

function renderModuleList(c) {
  const [selMi, selPi] = (S.curPageKey||'0-0').split('-').map(Number);
  const p = PROVIDER[c.provider] || PROVIDER.Other;
  const canEdit = S.role === 'admin' || S.role === 'instructor';

  const typeIco = t => {
    if (t==='lab') return `<svg class="si-ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 3H5a2 2 0 00-2 2v4m6-6h10a2 2 0 012 2v4M9 3v18m0 0h10a2 2 0 002-2V9M9 21H5a2 2 0 01-2-2V9m0 0h18"/></svg>`;
    if (t==='video') return `<svg class="si-ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>`;
    return `<svg class="si-ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>`;
  };

  const list = document.getElementById('moduleList');
  list.innerHTML = c.modules.map((mod, mi) => {
    const isExp = mi === selMi;
    const subs = mod.pages.map((pg, pi) => {
      const key = `${mi}-${pi}`;
      const isActive = key === S.curPageKey;
      const ck = `done_${S.curCourseId}_${key}`;
      const done = !!S.completedSteps[ck];
      return `<div class="sub-item ${isActive?'active':''}" onclick="loadPage('${key}')">
        <svg class="si-ico ${done?'sub-done':'sub-todo'}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        ${typeIco(pg.type)}
        <span style="flex:1">${pg.title}</span>
        <span class="si-type si-${pg.type}">${pg.type}</span>
      </div>`;
    }).join('');

    const addBtn = canEdit ? `<div class="add-page-in-module"><button class="add-pg-btn" onclick="event.stopPropagation();openAddPage(${mi})">+ Add Content</button></div>` : '';

    return `<div class="mod-item">
      <div class="mod-hdr ${isExp?'exp':''}" onclick="toggleMod(${mi})">
        <div class="mod-num" style="background:${mod.col}">${mi+1}</div>
        <div class="mod-title">${mod.title}</div>
        <div class="mod-cnt">${mod.pages.length}</div>
        <svg class="mod-chev" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg>
      </div>
      <div class="mod-subitems ${isExp?'open':''}" id="ms-${mi}">${subs}${addBtn}</div>
    </div>`;
  }).join('');

  if (canEdit) {
    list.innerHTML += `<div style="padding:10px 14px"><button onclick="openModal('addModuleModal')" style="width:100%;padding:8px;border:1px dashed rgba(255,255,255,0.12);border-radius:6px;background:transparent;color:var(--text3);cursor:pointer;font-family:'Space Grotesk',sans-serif;font-size:12px;font-weight:600;transition:all 0.15s" onmouseover="this.style.borderColor='var(--accent)';this.style.color='var(--accent)'" onmouseout="this.style.borderColor='rgba(255,255,255,0.12)';this.style.color='var(--text3)'">+ Add Module</button></div>`;
  }
}

function toggleMod(mi) {
  document.getElementById(`ms-${mi}`).classList.toggle('open');
  document.querySelectorAll('.mod-hdr')[mi].classList.toggle('exp');
}

function loadPage(key) {
  S.curPageKey = key;
  const c = S.courses.find(x=>x.id===S.curCourseId);
  renderModuleList(c);
  renderPageContent();
}

function getPage() {
  const c = S.courses.find(x=>x.id===S.curCourseId);
  if (!c||!S.curPageKey) return null;
  const [mi,pi] = S.curPageKey.split('-').map(Number);
  return c.modules[mi]?.pages[pi];
}

function renderPageContent() {
  const c = S.courses.find(x=>x.id===S.curCourseId);
  if (!c||!S.curPageKey) return;
  const [mi,pi] = S.curPageKey.split('-').map(Number);
  const mod = c.modules[mi]; const page = mod?.pages[pi];
  if (!page) return;
  const p = PROVIDER[c.provider]||PROVIDER.Other;

  const canEdit = S.role==='admin'||S.role==='instructor';
  const typeLabel = {doc:'Documentation',lab:'Hands-on Lab',video:'Video Lesson'};
  const typeIco = {
    doc:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>`,
    lab:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 3H5a2 2 0 00-2 2v4m6-6h10a2 2 0 012 2v4M9 3v18m0 0h10a2 2 0 002-2V9M9 21H5a2 2 0 01-2-2V9m0 0h18"/></svg>`,
    video:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>`,
  };

  let allPgs=[]; c.modules.forEach((m,mi2)=>m.pages.forEach((pg,pi2)=>allPgs.push({key:`${mi2}-${pi2}`,title:pg.title})));
  const curIdx=allPgs.findIndex(x=>x.key===S.curPageKey);
  const prev=allPgs[curIdx-1]; const next=allPgs[curIdx+1];

  const editToggle = canEdit ? `
    <label style="display:flex;align-items:center;gap:7px;cursor:pointer;margin-left:auto;user-select:none">
      <span style="font-size:11.5px;font-weight:700;color:${S.editMode?'var(--accent)':'var(--text3)'};font-family:'JetBrains Mono',monospace">✏ EDIT</span>
      <div onclick="toggleEdit(!S.editMode)" style="width:36px;height:20px;background:${S.editMode?'var(--accent)':'var(--bg4)'};border-radius:10px;position:relative;cursor:pointer;transition:background 0.2s;border:1px solid ${S.editMode?'var(--accent)':'var(--border2)'}">
        <div style="position:absolute;top:2px;left:${S.editMode?'17':'3'}px;width:14px;height:14px;background:${S.editMode?'#000':'var(--text3)'};border-radius:50%;transition:left 0.2s"></div>
      </div>
    </label>` : '';

  const becomeBanner = S.role==='student' ? `
    <div class="become-instructor-banner">
      <span class="bib-ico">🎓</span>
      <div class="bib-text">
        <h4>Become a codethebox Instructor</h4>
        <p>Share your expertise — apply to create and manage course content</p>
      </div>
      <button class="bib-btn" onclick="openModal('instructorApplyModal')">Apply Now</button>
    </div>` : '';

  const area = document.getElementById('contentArea');
  area.innerHTML = `
    <div class="bcrumb">
      <a onclick="showView('catalog')">Catalog</a><span>›</span>
      <a onclick="showView('catalog')" style="color:${p.color}">${c.id}</a><span>›</span>
      <span>${mod.title}</span><span>›</span><span>${page.title}</span>
      ${editToggle}
    </div>
    ${becomeBanner}
    <div class="content-type-chip ctc-${page.type}">${typeIco[page.type]} ${typeLabel[page.type]}${page.dur?` · ${page.dur}`:''}</div>
    <h1 class="page-title-h" id="pgTitle" ${S.editMode?'contenteditable="true"':''}>${page.title}</h1>
    <div class="blocks-container" id="blocksContainer">${page.blocks.map((b,i)=>renderBlock(b,i)).join('')}</div>
    <div class="add-block-bar">
      <span class="abl">Add block:</span>
      <button class="abb" onclick="addBlock('text')">📝 Text</button>
      <button class="abb" onclick="addBlock('heading')">📌 Heading</button>
      <button class="abb" onclick="addBlock('note')">ℹ Note</button>
      <button class="abb" onclick="addBlock('tip')">✅ Tip</button>
      <button class="abb" onclick="addBlock('warning')">⚠ Warning</button>
      <button class="abb" onclick="addBlock('danger')">🚫 Danger</button>
      <button class="abb" onclick="addBlock('code')">💻 Code</button>
      <button class="abb" onclick="addBlock('card')">🃏 Card</button>
      <button class="abb" onclick="openModal('addVideoModal')">▶ Video</button>
      <button class="abb" onclick="openModal('addImageModal')">🖼 Image</button>
      <button class="abb" onclick="openModal('addLinkModal')">🔗 Link</button>
    </div>
    <div class="page-nav">
      ${prev?`<button class="pn-btn" onclick="loadPage('${prev.key}')"><span class="pn-dir">← Previous</span><span class="pn-title">${prev.title}</span></button>`:'<div></div>'}
      ${next?`<button class="pn-btn right" onclick="loadPage('${next.key}')"><span class="pn-dir">Next →</span><span class="pn-title">${next.title}</span></button>`:'<div></div>'}
    </div>`;

  // Title editable
  if (S.editMode) {
    const te = document.getElementById('pgTitle');
    if (te) te.oninput = ()=>{ page.title=te.textContent; renderModuleList(c); };
  }

  attachEditable(page);
  renderTOC(page);
}

function renderBlock(b, bi) {
  const tb = `<div class="btb-wrap"><button class="btb mov" onclick="moveBlock(${bi},-1)">↑</button><button class="btb mov" onclick="moveBlock(${bi},1)">↓</button><button class="btb del" onclick="deleteBlock(${bi})">✕</button></div>`;

  if (b.t==='lab-meta') return `<div class="block" data-bi="${bi}">${tb}<div class="lab-header-bar"><div class="lab-ico-wrap"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 3H5a2 2 0 00-2 2v4m6-6h10a2 2 0 012 2v4M9 3v18m0 0h10a2 2 0 002-2V9M9 21H5a2 2 0 01-2-2V9m0 0h18"/></svg></div><div class="lab-hdr-text"><h3>Hands-on Lab</h3><p>Complete all steps to earn ${b.points||50} points</p></div></div><div class="lab-meta-grid"><div class="lab-mc"><div class="lmv">${b.duration||'30 min'}</div><div class="lmk">Duration</div></div><div class="lab-mc"><div class="lmv">${b.difficulty||'Beginner'}</div><div class="lmk">Difficulty</div></div><div class="lab-mc"><div class="lmv">${b.points||50}</div><div class="lmk">Points</div></div></div></div>`;

  if (b.t==='step') {
    const ck=`done_${S.curCourseId}_${S.curPageKey}_s${b.n}`;
    const done=!!S.completedSteps[ck];
    return `<div class="block" data-bi="${bi}">${tb}<div class="step-block"><div class="step-hdr"><div class="step-num-b">${b.n}</div><h4>${b.title}</h4><button class="step-done-btn ${done?'s-done':'s-undone'}" onclick="toggleStep('${ck}',this)">${done?'✓ Completed':'Mark done'}</button></div><div class="step-body">${b.c}</div></div></div>`;
  }

  if (b.t==='video') {
    const em=ytEmbed(b.url);
    return `<div class="block" data-bi="${bi}">${tb}<div class="b-video"><div class="video-wrapper">${em?`<iframe src="${em}" allowfullscreen></iframe>`:`<div class="video-ph"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polygon points="5 3 19 12 5 21 5 3"/></svg><span style="font-size:13px">Set a YouTube URL in edit mode</span></div>`}</div><div class="v-cap" id="vc-${bi}">${b.cap||''}</div></div></div>`;
  }

  if (b.t==='image') return `<div class="block" data-bi="${bi}">${tb}<div class="b-image">${b.url?`<img class="img-actual" src="${b.url}" alt="${b.cap||''}">`:`<div class="img-ph" onclick="openImgModal(${bi})"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg><span>Click to set image URL</span></div>`}<div class="i-cap">${b.cap||''}</div></div></div>`;

  if (b.t==='link') return `<div class="block" data-bi="${bi}">${tb}<a class="b-link-card" href="${b.url}" target="_blank"><div class="b-link-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></div><div><div class="blk-lt">${b.lt||b.url}</div><div class="blk-ld">${b.ld||''}</div></div><div class="blk-arr"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg></div></a></div>`;

  let inner='';
  if (b.t==='heading') inner=`<h2 class="b-h" id="bh-${bi}">${b.c}</h2>`;
  else if (b.t==='text') inner=`<div class="b-text"><p>${b.c}</p></div>`;
  else if (b.t==='note') inner=`<div class="callout note"><span class="c-ico">ℹ</span><div class="c-body">${b.c}</div></div>`;
  else if (b.t==='tip') inner=`<div class="callout tip"><span class="c-ico">✓</span><div class="c-body">${b.c}</div></div>`;
  else if (b.t==='warning') inner=`<div class="callout warning"><span class="c-ico">⚠</span><div class="c-body">${b.c}</div></div>`;
  else if (b.t==='danger') inner=`<div class="callout danger"><span class="c-ico">🚫</span><div class="c-body">${b.c}</div></div>`;
  else if (b.t==='code') inner=`<pre class="b-code">${esc(b.c)}</pre>`;
  else if (b.t==='card') inner=`<div class="b-card"><h4>${b.h||'Card'}</h4><p>${b.c}</p></div>`;

  return `<div class="block" data-bi="${bi}">${tb}${inner}</div>`;
}

function attachEditable(page) {
  if (!S.editMode) return;
  const con = document.getElementById('blocksContainer');
  page.blocks.forEach((b,bi)=>{
    const el=con.querySelector(`[data-bi="${bi}"]`); if(!el) return;
    if (b.t==='text') { const p=el.querySelector('.b-text p'); if(p){p.contentEditable='true';p.oninput=()=>b.c=p.innerHTML;} }
    else if (b.t==='heading') { const h=el.querySelector('.b-h'); if(h){h.contentEditable='true';h.oninput=()=>{b.c=h.textContent;renderTOC(page);};} }
    else if (['note','tip','warning','danger'].includes(b.t)) { const cb=el.querySelector('.c-body'); if(cb){cb.contentEditable='true';cb.oninput=()=>b.c=cb.innerHTML;} }
    else if (b.t==='code') { const pre=el.querySelector('pre'); if(pre){pre.contentEditable='true';pre.oninput=()=>b.c=pre.textContent;} }
    else if (b.t==='card') { const h4=el.querySelector('h4'),pp=el.querySelector('p'); if(h4){h4.contentEditable='true';h4.oninput=()=>b.h=h4.textContent;} if(pp){pp.contentEditable='true';pp.oninput=()=>b.c=pp.innerHTML;} }
    else if (b.t==='video') { const vc=el.querySelector('.v-cap'); if(vc){vc.contentEditable='true';vc.oninput=()=>b.cap=vc.textContent;} }
  });
}

function renderTOC(page) {
  document.getElementById('pageTOC').innerHTML = page.blocks.filter(b=>b.t==='heading').map(b=>`<a class="toc-a" href="#">${b.c}</a>`).join('');
}

// ═══════════════════════════════════════════════════
//   BLOCKS CRUD
// ═══════════════════════════════════════════════════
function addBlock(type) {
  const page=getPage(); if(!page) return;
  const defs = { text:{t:'text',c:'Enter content here...'}, heading:{t:'heading',c:'New Section'}, note:{t:'note',c:'Note content...'}, tip:{t:'tip',c:'Tip content...'}, warning:{t:'warning',c:'Warning content...'}, danger:{t:'danger',c:'Danger note...'}, code:{t:'code',c:'# code here'}, card:{t:'card',h:'Card Title',c:'Card description.'} };
  page.blocks.push(defs[type]||{t:type,c:''});
  renderPageContent();
  showToast('Block added','cyan');
}

function deleteBlock(bi) { const p=getPage(); if(!p) return; p.blocks.splice(bi,1); renderPageContent(); }
function moveBlock(bi,dir) { const p=getPage(); if(!p) return; const ni=bi+dir; if(ni<0||ni>=p.blocks.length) return; [p.blocks[bi],p.blocks[ni]]=[p.blocks[ni],p.blocks[bi]]; renderPageContent(); }

let _vBi=null, _iBi=null;
function commitVideo() { const url=document.getElementById('vb-url').value.trim(); const cap=document.getElementById('vb-cap').value.trim(); const pg=getPage(); if(!pg) return; if(_vBi!==null){pg.blocks[_vBi].url=url;pg.blocks[_vBi].cap=cap;}else{pg.blocks.push({t:'video',url,cap});} closeModal('addVideoModal'); renderPageContent(); showToast('Video embedded','cyan'); _vBi=null; }
function openImgModal(bi) { _iBi=bi; openModal('addImageModal'); }
function commitImage() { const url=document.getElementById('ib-url').value.trim(); const cap=document.getElementById('ib-cap').value.trim(); const pg=getPage(); if(!pg) return; if(_iBi!==null){pg.blocks[_iBi].url=url;pg.blocks[_iBi].cap=cap;}else{pg.blocks.push({t:'image',url,cap});} closeModal('addImageModal'); renderPageContent(); showToast('Image added','cyan'); _iBi=null; }
function commitLink() { const url=document.getElementById('lb-url').value.trim(); const lt=document.getElementById('lb-title').value.trim(); const ld=document.getElementById('lb-desc').value.trim(); const pg=getPage(); if(!pg) return; pg.blocks.push({t:'link',url,lt,ld}); closeModal('addLinkModal'); renderPageContent(); showToast('Link added','cyan'); }

function toggleStep(ck,btn) { S.completedSteps[ck]=!S.completedSteps[ck]; btn.textContent=S.completedSteps[ck]?'✓ Completed':'Mark done'; btn.className='step-done-btn '+(S.completedSteps[ck]?'s-done':'s-undone'); showToast(S.completedSteps[ck]?'Step completed! ✓':'Step marked incomplete','green'); }

function toggleEdit(on) {
  if (S.role==='student') { showToast('Students cannot edit content','amber'); return; }
  if (S.role==='guest') { openModal('loginModal'); return; }
  S.editMode=on;
  document.body.classList.toggle('edit-mode',on);
  renderPageContent();
  if (on) showToast('Edit mode enabled ✏','cyan');
}

// ═══════════════════════════════════════════════════
//   COURSE STRUCTURE
// ═══════════════════════════════════════════════════
function openAddPage(mi) { S.addingToMod=mi; openModal('addPageModal'); }

function addPage() {
  const c=S.courses.find(x=>x.id===S.curCourseId); if(!c) return;
  const title=document.getElementById('ap-title').value.trim();
  const type=document.getElementById('ap-type').value;
  const url=document.getElementById('ap-url').value.trim();
  const dur=document.getElementById('ap-dur').value.trim();
  if(!title) return;
  const mi=S.addingToMod||0;
  const defBlocks = type==='lab'
    ?[{t:'lab-meta',duration:dur||'30 min',difficulty:'Beginner',points:50},{t:'heading',c:'Lab Objectives'},{t:'text',c:'Describe objectives here.'}]
    :type==='video'
    ?[{t:'heading',c:title},{t:'video',url:url||'',cap:'Video caption'},{t:'text',c:'Video notes.'}]
    :[{t:'heading',c:title},{t:'text',c:'Start writing here.'}];
  c.modules[mi].pages.push({title,type,dur,url,blocks:defBlocks});
  closeModal('addPageModal');
  S.curPageKey=`${mi}-${c.modules[mi].pages.length-1}`;
  renderCourseView();
  showToast(`"${title}" created`,'green');
}

function addModule() {
  const c=S.courses.find(x=>x.id===S.curCourseId); if(!c) return;
  const title=document.getElementById('nm-title').value.trim(); if(!title) return;
  const cols=['#FF9900','#4285F4','#0078D4','#D83B01','#C8202A','#8B5CF6','#10B981'];
  c.modules.push({title,col:cols[c.modules.length%cols.length],pages:[]});
  closeModal('addModuleModal');
  renderCourseView();
  showToast(`Module "${title}" added`,'green');
}

// ═══════════════════════════════════════════════════
//   MANAGER
// ═══════════════════════════════════════════════════
function renderManager() { renderMgrCourses(); renderPermTable(); renderRequestsTable(); }

function renderMgrCourses() {
  document.getElementById('mgrCoursesGrid').innerHTML = S.courses.map(c=>{
    const p=PROVIDER[c.provider]||PROVIDER.Other;
    const totalPgs=c.modules.reduce((s,m)=>s+m.pages.length,0);
    return `<div class="mgr-card">
      <span style="font-family:'JetBrains Mono',monospace;font-size:11px;color:${p.color};font-weight:600">${c.provider} · ${c.id}</span>
      <h4>${c.name}</h4>
      <p>${c.level} · ${c.modules.length} modules · ${totalPgs} pages</p>
      <div class="mgr-actions">
        <button class="mc-btn primary" onclick="openCourse('${c.id}');showView('course')">Open</button>
        <button class="mc-btn danger" onclick="if(confirm('Delete ${c.id}?')){S.courses=S.courses.filter(x=>x.id!='${c.id}');renderManager();showToast('Deleted','amber')}">Delete</button>
      </div>
    </div>`;
  }).join('');
}

function renderPermTable() {
  const rc={'admin':'av-a','instructor':'av-i','student':'av-s'};
  document.getElementById('permTable').innerHTML=`<thead><tr><th>User</th><th>Email</th><th>Role</th><th>Joined</th><th>Change Role</th></tr></thead><tbody>${S.users.map((u,i)=>`<tr><td><div style="display:flex;align-items:center;gap:10px"><div class="u-av ${rc[u.role]||'av-s'}">${u.name.split(' ').map(w=>w[0]).join('').substring(0,2)}</div>${u.name}</div></td><td style="color:var(--text3)">${u.email}</td><td><span style="font-size:11px;font-weight:700;padding:3px 9px;border-radius:20px;background:rgba(255,255,255,0.06);color:var(--text2)">${u.role}</span></td><td style="color:var(--text3);font-size:12px">${u.joined}</td><td><select class="perm-sel" onchange="S.users[${i}].role=this.value;renderPermTable();showToast('Role updated','green')"><option ${u.role==='student'?'selected':''} value="student">Student</option><option ${u.role==='instructor'?'selected':''} value="instructor">Instructor</option><option ${u.role==='admin'?'selected':''} value="admin">Admin</option></select></td></tr>`).join('')}</tbody>`;
}

function renderRequestsTable() {
  const sc={'pending':'req-pending','approved':'req-approved','rejected':'req-rejected'};
  document.getElementById('requestsTable').innerHTML=`<thead><tr><th>Name</th><th>Email</th><th>Certifications</th><th>Status</th><th>Actions</th></tr></thead><tbody>${S.instructorRequests.map((r,i)=>`<tr><td><strong>${r.name}</strong><br><span style="font-size:11.5px;color:var(--text3)">${r.linkedin}</span></td><td style="color:var(--text3)">${r.email}</td><td style="font-size:12.5px">${r.certs}</td><td><span class="req-badge ${sc[r.status]}">${r.status}</span></td><td><div style="display:flex;gap:6px">${r.status==='pending'?`<button onclick="S.instructorRequests[${i}].status='approved';renderRequestsTable();showToast('Approved! Email sent to '+S.instructorRequests[${i}].email,'green')" style="padding:4px 10px;border-radius:5px;background:rgba(16,185,129,0.1);color:var(--green);border:1px solid rgba(16,185,129,0.3);cursor:pointer;font-size:12px;font-weight:600">Approve</button><button onclick="S.instructorRequests[${i}].status='rejected';renderRequestsTable();showToast('Application rejected','amber')" style="padding:4px 10px;border-radius:5px;background:rgba(244,63,94,0.1);color:var(--rose);border:1px solid rgba(244,63,94,0.3);cursor:pointer;font-size:12px;font-weight:600">Reject</button>`:'<span style="font-size:12px;color:var(--text3)">—</span>'}</div></td></tr>`).join('')}</tbody>`;
}

function switchMgrTab(tab, btn) {
  document.querySelectorAll('.m-tab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('mgrCourses').style.display=tab==='courses'?'':'none';
  document.getElementById('mgrUsers').style.display=tab==='users'?'':'none';
  document.getElementById('mgrRequests').style.display=tab==='requests'?'':'none';
}

function addCourse() {
  const id=document.getElementById('nc-id').value.trim().toUpperCase();
  const name=document.getElementById('nc-name').value.trim();
  const provider=document.getElementById('nc-provider').value;
  const level=document.getElementById('nc-level').value;
  const desc=document.getElementById('nc-desc').value.trim();
  const duration=document.getElementById('nc-dur').value.trim()||'0 hours';
  if(!id||!name) return;
  S.courses.push({id,name,provider,level,desc,duration,progress:0,modules:[]});
  closeModal('addCourseModal');
  renderManager();
  renderCatalog();
  showToast(`Course ${id} created`,'green');
}

function addUser() {
  const name=document.getElementById('au-name').value.trim();
  const email=document.getElementById('au-email').value.trim();
  const role=document.getElementById('au-role').value;
  if(!name||!email) return;
  S.users.push({id:Date.now(),name,email,role,joined:new Date().toISOString().split('T')[0]});
  closeModal('addUserModal');
  renderPermTable();
  showToast(`${name} added`,'green');
}

// ═══════════════════════════════════════════════════
//   MODALS & UTILS
// ═══════════════════════════════════════════════════
function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.modal-overlay').forEach(o=>o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('open');}));

let _toast;
function showToast(msg,type='cyan') {
  const t=document.getElementById('toast');
  t.textContent=msg; t.className=`toast ${type} show`;
  clearTimeout(_toast); _toast=setTimeout(()=>t.classList.remove('show'),2500);
}

function ytEmbed(url) { if(!url) return ''; const m=url.match(/(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([A-Za-z0-9_-]{11})/); return m?`https://www.youtube.com/embed/${m[1]}`:(url.includes('embed')?url:''); }
function esc(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

// Init
updateUserUI();
showView('home');
document.getElementById('hStat1').textContent = S.courses.length + '+';
</script>
</body>
</html>